try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})["__faroBundleId_gptengineer-app"]="17618321824302d6d31c39f"}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[624],{98251:(e,t,i)=>{let r;function n(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function s(e){return function t(i){return 0==arguments.length||n(i)?t:e.apply(this,arguments)}}function a(e){return function t(i,r){switch(arguments.length){case 0:return t;case 1:return n(i)?t:s(function(t){return e(i,t)});default:return n(i)&&n(r)?t:n(i)?s(function(t){return e(t,r)}):n(r)?s(function(t){return e(i,t)}):e(i,r)}}}function o(e){return function t(i,r,o){switch(arguments.length){case 0:return t;case 1:return n(i)?t:a(function(t,r){return e(i,t,r)});case 2:return n(i)&&n(r)?t:n(i)?a(function(t,i){return e(t,r,i)}):n(r)?a(function(t,r){return e(i,t,r)}):s(function(t){return e(i,r,t)});default:return n(i)&&n(r)&&n(o)?t:n(i)&&n(r)?a(function(t,i){return e(t,i,o)}):n(i)&&n(o)?a(function(t,i){return e(t,r,i)}):n(r)&&n(o)?a(function(t,r){return e(i,t,r)}):n(i)?s(function(t){return e(t,r,o)}):n(r)?s(function(t){return e(i,t,o)}):n(o)?s(function(t){return e(i,r,t)}):e(i,r,o)}}}function l(e,t){return Object.prototype.hasOwnProperty.call(t,e)}i.d(t,{p:()=>si});var u,c,d,h=s(function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function g(e){return"[object Object]"===Object.prototype.toString.call(e)}let p=Number.isInteger||function(e){return(0|e)===e};var f=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){var i=this.hash(e),r=this.map[i];r||(this.map[i]=r=[]),r.push([e,t]),this.length+=1},e.prototype.hash=function(e){var t=[];for(var i in e)t.push(Object.prototype.toString.call(e[i]));return t.join()},e.prototype.get=function(e){if(this.length<=180){for(var t in this.map)for(var i=this.map[t],r=0;r<i.length;r+=1){var n=i[r];if(n[0]===e)return n[1]}return}var s=this.hash(e),i=this.map[s];if(i)for(var r=0;r<i.length;r+=1){var n=i[r];if(n[0]===e)return n[1]}},e}(),v=s(function(e){return null!=e&&"function"==typeof e.clone?e.clone():function e(t,i,r){if(r||(r=new f),s=typeof(n=t),null==n||"object"!=s&&"function"!=s)return t;var n,s,a=function(i){var n=r.get(t);if(n)return n;for(var s in r.set(t,i),t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e(t[s],!0,r));return i};switch(h(t)){case"Object":return a(Object.create(Object.getPrototypeOf(t)));case"Array":return a(Array(t.length));case"Date":return new Date(t.valueOf());case"RegExp":return new RegExp(t.source,t.flags?t.flags:(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"")+(t.unicode?"u":"")+(t.dotAll?"s":""));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return t.slice();default:return t}}(e)}),y=o(function(e,t,i){var r,n={};for(r in i=i||{},t=t||{})l(r,t)&&(n[r]=l(r,i)?e(r,t[r],i[r]):t[r]);for(r in i)l(r,i)&&!l(r,n)&&(n[r]=i[r]);return n}),m=o(function e(t,i,r){return y(function(i,r,n){return g(r)&&g(n)?e(t,r,n):t(i,r,n)},i,r)}),b=o(function(e,t,i){return m(function(t,i,r){return e(i,r)},t,i)}),E=a(function(e,t){for(var i=t,r=0;r<e.length;r+=1){if(null==i)return;var n=e[r];i=p(n)?function(e,t){var i=e<0?t.length+e:e;return t[i]}(n,i):i[n]}return i}),I=a(function(e,t){var i={};for(var r in t)e(t[r],r,t)&&(i[r]=t[r]);return i});let k=e=>"function"==typeof e&&!!(e.constructor&&e.call&&e.apply),S=e=>"string"==typeof e,A=e=>void 0!==e,T=e=>!(e=>null==e)(e),w=e=>{switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},C=(e,t)=>E(t.split("."),e),D=e=>null!==e&&"[object Object]"===Object.prototype.toString.call(e),P=(e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return v(t);let i=v(e);return t.forEach((e,t)=>{i[t]=Array.isArray(e)||(e=>null!==e&&"object"==typeof e&&!Array.isArray(e))(e)?O(i[t],e):e}),i},O=(e,t)=>b(P,e,t),R=e=>D(e)&&Object.keys(e).length>0,x=e=>{let t=I(A,e);return Object.keys(t).forEach(e=>{let i=t[e];D(i)&&(t[e]=x(i))}),t},$=e=>{let t=I(T,e);return Object.keys(t).forEach(e=>{let i=t[e];D(i)&&(t[e]=$(i))}),t},M=e=>{if(R(e))return $(e)},N=(e,t)=>"boolean"==typeof e?e:t,_=e=>(Object.getOwnPropertyNames(e).forEach(function(t){e[t]&&"object"==typeof e[t]&&_(e[t])}),Object.freeze(e)),B=e=>e.replace(/^\.+/,""),L=e=>{let t=e;if(!S(e)&&!(e=>null==e)(e))try{t=JSON.stringify(e)}catch(e){t=null}return t},U=e=>globalThis.btoa(Array.from(new TextEncoder().encode(e),e=>String.fromCodePoint(e)).join("")),j=e=>new TextDecoder().decode(new Uint8Array(globalThis.atob(e).split("").map(e=>e.charCodeAt(0)))),H=(e,t,i,r,n)=>{let s={category:e,name:t,properties:i,options:r,callback:void 0};k(n)&&(s.callback=n),k(r)&&(s.category=e,s.name=t,s.properties=i,s.options=void 0,s.callback=r),k(i)&&(s.category=e,s.name=t,s.properties=void 0,s.options=void 0,s.callback=i),k(t)&&(s.category=e,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=t),k(e)&&(s.category=void 0,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=e),D(e)?(s.name=void 0,s.category=void 0,s.properties=e,k(t)?s.options=void 0:s.options=t):D(t)&&(s.name=void 0,s.properties=t,k(i)?s.options=void 0:s.options=i),S(e)&&!S(t)&&(s.category=void 0,s.name=e),A(s.category)||(s.category=void 0),A(s.name)||(s.name=void 0),s.properties=s.properties?v(s.properties):{},A(s.options)?s.options=v(s.options):s.options=void 0;let a=S(s.name)?s.name:s.properties.name,o=S(s.category)?s.category:s.properties.category;return s.properties=O(D(s.properties)?s.properties:{},{...a&&{name:a},...o&&{category:o}}),s},F=(e,t,i,r)=>{let n={name:e,properties:t,options:i,callback:void 0};return k(r)&&(n.callback=r),k(i)&&(n.properties=t,n.options=void 0,n.callback=i),k(t)&&(n.properties=void 0,n.options=void 0,n.callback=t),n.properties=T(n.properties)?v(n.properties):{},A(n.options)?n.options=v(n.options):n.options=void 0,n},z=(e,t,i,r)=>{let n={userId:e,traits:t,options:i,callback:void 0};return k(r)&&(n.callback=r),k(i)&&(n.userId=e,n.traits=t,n.options=void 0,n.callback=i),k(t)&&(n.userId=e,n.traits=void 0,n.options=void 0,n.callback=t),(D(e)||null===e)&&(n.userId=null,n.traits=e,k(t)?n.options=void 0:n.options=t),n.userId=L(n.userId),D(n.traits)?n.traits=v(n.traits):n.traits=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},Q=(e,t,i,r)=>{let n={to:e,from:t,options:i,callback:void 0};return(k(r)&&(n.callback=r),k(i)&&(n.to=e,n.from=t,n.options=void 0,n.callback=i),k(t))?(n.to=e,n.from=void 0,n.options=void 0,n.callback=t):(D(t)||null===t)&&(n.to=e,n.from=void 0,n.options=t),A(n.to)&&(n.to=L(n.to)),A(n.from)?n.from=L(n.from):n.from=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},G=(e,t,i,r)=>{let n={groupId:e,traits:t,options:i,callback:void 0};return k(r)&&(n.callback=r),k(i)&&(n.groupId=e,n.traits=t,n.options=void 0,n.callback=i),k(t)&&(n.groupId=e,n.traits=void 0,n.options=void 0,n.callback=t),(D(e)||null===e)&&(n.groupId=null,n.traits=e,k(t)?n.options=void 0:n.options=t),n.groupId=L(n.groupId),D(n.traits)?n.traits=v(n.traits):n.traits=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},K=function(e){return e.UNLOADED="Page Unloaded",e}({}),V="CapabilitiesManager",q="ConfigManager",W="EventManager",J="PluginsManager",X="UserSessionManager",Z="ErrorHandler",Y="PluginEngine",ee="ReadyAPI",et="AnalyticsCore";for(var ei,er=[],en=0;en<256;en++)er[en]=(en+256).toString(16).substring(1);for(var es,ea=256,eo=[];ea--;)eo[ea]=(ea+256).toString(16).substring(1);let el=()=>!(e=>null==e)(globalThis.crypto)&&k(globalThis.crypto.getRandomValues)?function(){(!ei||en+16>4096)&&(ei=crypto.getRandomValues(new Uint8Array(4096)),en=0);for(var e,t=0,i="";t<16;t++)e=ei[en+t],6==t?i+=er[15&e|64]:8==t?i+=er[63&e|128]:i+=er[e],1&t&&t>1&&t<11&&(i+="-");return en+=16,i}():function(){var e,t=0,i="";if(!es||ea+16>256){for(es=Array(t=256);t--;)es[t]=256*Math.random()|0;t=ea=0}for(;t<16;t++)e=es[ea+t],6==t?i+=eo[15&e|64]:8==t?i+=eo[63&e|128]:i+=eo[e],1&t&&t>1&&t<11&&(i+="-");return ea++,i}(),eu=()=>S(globalThis.navigator.userAgent)&&/Trident.*rv:11\./.test(globalThis.navigator.userAgent),ec=e=>{let t=!1,i=!1;function r(){t||(t=!0,e(i),setTimeout(()=>{t=!1},0))}eu()&&globalThis.addEventListener("beforeunload",()=>{i=!1,r()}),globalThis.addEventListener("blur",()=>{i=!0,r()}),globalThis.addEventListener("focus",()=>{t=!1}),document.addEventListener("pagehide",()=>{i="hidden"===document.visibilityState,r()}),document.addEventListener("visibilitychange",()=>{i=!0,"hidden"===document.visibilityState?r():t=!1})},ed=e=>e.toISOString(),eh=()=>ed(new Date),eg=(e,t,i)=>`Unable to load (${S(i)?i:i.type}) the script with the id "${e}" from URL "${t}"`,ep="[Circular Reference]",ef=(e,t,i,r)=>{try{return JSON.stringify(e,((e,t,i)=>{let r=[];return function(n,s){if(!t?.includes(n)){let t;if(!(e&&null==(t=s))){if("object"!=typeof s||null===s)return s;for(;r.length>0&&r[r.length-1]!==this;)r.pop();if(r.includes(s))return i?.warn(`JSONStringify:: A circular reference has been detected in the object and the property "${n}" has been dropped from the output.`),ep;return r.push(s),s}}}})(t,i,r))}catch(e){return r?.warn("Failed to convert the value to a JSON string.",e),null}},ev=(e,t)=>{let i=Array.isArray(e)?[]:{};for(let r in e)if(Object.hasOwnProperty.call(e,r)){let n=e[r],s=t.call(e,r,n);D(s)||Array.isArray(s)?i[r]=ev(s,t):i[r]=s}return i},ey=(e,t)=>{let i=(e=>{let t=[];return function(e,i){if("bigint"==typeof i)return"[BigInt]";for(;t.length>0&&t[t.length-1]!==this;)t.pop();return t.includes(i)?ep:(t.push(i),i)}})(),r=i.call(e,"",e);return D(e)||Array.isArray(e)?ev(e,i):r},em="[SDK DISPATCHED ERROR]",eb=e=>{let{stack:t,stacktrace:i,"opera#sourceloc":r}=e,n=t??i??r;if(n&&"string"==typeof n)return n},eE=(e,t)=>{if(!w(e))return Error(`${t}: ${ef(e)}`);try{let i=new e.constructor(`${t}: ${e.message}`),r=eb(e);return r&&(i.stack=r),Object.getOwnPropertyNames(e).forEach(t=>{if("message"!==t&&"stack"!==t&&"name"!==t)try{i[t]=e[t]}catch{}}),i}catch{return Error(`${t}: ${ef(e)}`)}},eI=e=>{if(w(e)){let t=eb(e);if(t){let{stack:i,stacktrace:r,"opera#sourceloc":n}=e;switch(t){case i:e.stack=`${i}
${em}`;break;case r:e.stacktrace=`${r}
${em}`;break;default:e["opera#sourceloc"]=`${n}
${em}`}}}globalThis.dispatchEvent(new ErrorEvent("error",{error:e,bubbles:!0,cancelable:!0,composed:!0}))},ek="RudderLabs JavaScript SDK",eS="3.24.2",eA="RudderJS-Initiated",eT="preloadedEventsBuffer",ew="ajs_aid",eC="ajs_uid",eD="ajs_event",eP=1e4,eO=(e="app")=>{globalThis.RudderStackGlobals||(globalThis.RudderStackGlobals={}),globalThis.RudderStackGlobals[e]||(globalThis.RudderStackGlobals[e]={})},eR=(e,t,i="app")=>{eO(i),globalThis.RudderStackGlobals[i][e]=t},ex=(e,t="app")=>(eO(t),globalThis.RudderStackGlobals[t][e]),e$=(e,t)=>{let i={};return e.forEach((r,n)=>{n.startsWith(t)&&(i[n.substring(t.length)]=e.get(n))}),i},eM=(e,t)=>{let i,r=e.shift();if(k(t[r])){switch(r){case"page":i=H(...e);break;case"track":i=F(...e);break;case"identify":i=z(...e);break;case"alias":i=Q(...e);break;case"group":i=G(...e);break;default:t[r](...e)}i&&t[r](i)}};class eN{constructor(e,t=1e4){this.logger=e,this.timeout=t}loadJSFile(e){let{url:t,id:i,timeout:r,async:n,callback:s,extraAttributes:a}=e,o=!k(s);((e,t,i,r=!0,n)=>new Promise((s,a)=>{document.getElementById(t)&&a(Error(`A script with the id "${t}" is already loaded. Skipping the loading of this script to prevent conflicts`));try{let o;(e=>{let t=document.getElementsByTagName("head");if(t.length>0)return t[0]?.insertBefore(e,t[0]?.firstChild);let i=document.getElementsByTagName("script");if(i.length>0&&i[0]?.parentNode)return i[0]?.parentNode.insertBefore(e,i[0]);let r=document.createElement("head");r.appendChild(e);let n=document.getElementsByTagName("html")[0];n?.insertBefore(r,n.firstChild)})(((e,t,i=!0,r=null,n=null,s={})=>{let a=document.createElement("script");return a.type="text/javascript",a.onload=r,a.onerror=n,a.src=e,a.id=t,a.async=i,Object.keys(s).forEach(e=>{a.setAttribute(e,s[e])}),a.setAttribute("data-loader","RS_JS_SDK"),a})(e,t,r,()=>{globalThis.clearTimeout(o),s(t)},i=>{globalThis.clearTimeout(o),a(Error(eg(t,e,i)))},n)),o=globalThis.setTimeout(()=>{a(Error(`A timeout of ${i} ms occurred while trying to load the script with id "${t}" from URL "${e}"`))},i)}catch(i){a(eE(i,eg(t,e,"unknown")))}}))(t,i,r||this.timeout,n,a).then(e=>{o||s(e)}).catch(e=>{o||s(i,e)})}}var e_=Symbol.for("preact-signals");function eB(){if(eF>1)eF--;else{for(var e,t=!1;void 0!==eH;){var i=eH;for(eH=void 0,ez++;void 0!==i;){var r=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&eq(i))try{i.c()}catch(i){t||(e=i,t=!0)}i=r}}if(ez=0,eF--,t)throw e}}function eL(e){if(eF>0)return e();eF++;try{return e()}finally{eB()}}var eU=void 0;function ej(e){var t=eU;eU=void 0;try{return e()}finally{eU=t}}var eH=void 0,eF=0,ez=0,eQ=0;function eG(e){if(void 0!==eU){var t=e.n;if(void 0===t||t.t!==eU)return t={i:0,S:e,p:eU.s,n:void 0,t:eU,e:void 0,x:void 0,r:t},void 0!==eU.s&&(eU.s.n=t),eU.s=t,e.n=t,32&eU.f&&e.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=eU.s,t.n=void 0,eU.s.n=t,eU.s=t),t}}function eK(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched}function eV(e,t){return new eK(e,t)}function eq(e){for(var t=e.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function eW(e){for(var t=e.s;void 0!==t;t=t.n){var i=t.S.n;if(void 0!==i&&(t.r=i),t.S.n=t,t.i=-1,void 0===t.n){e.s=t;break}}}function eJ(e){for(var t=e.s,i=void 0;void 0!==t;){var r=t.p;-1===t.i?(t.S.U(t),void 0!==r&&(r.n=t.n),void 0!==t.n&&(t.n.p=r)):i=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=r}e.s=i}function eX(e,t){eK.call(this,void 0),this.x=e,this.s=void 0,this.g=eQ-1,this.f=4,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched}function eZ(e){var t=e.u;if(e.u=void 0,"function"==typeof t){eF++;var i=eU;eU=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,eY(e),t}finally{eU=i,eB()}}}function eY(e){for(var t=e.s;void 0!==t;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,eZ(e)}function e0(e){if(eU!==this)throw Error("Out-of-order effect");eJ(this),eU=e,this.f&=-2,8&this.f&&eY(this),eB()}function e1(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function e2(e){var t=new e1(e);try{t.c()}catch(e){throw t.d(),e}var i=t.d.bind(t);return i[Symbol.dispose]=i,i}eK.prototype.brand=e_,eK.prototype.h=function(){return!0},eK.prototype.S=function(e){var t=this,i=this.t;i!==e&&void 0===e.e&&(e.x=i,this.t=e,void 0!==i?i.e=e:ej(function(){var e;null==(e=t.W)||e.call(t)}))},eK.prototype.U=function(e){var t=this;if(void 0!==this.t){var i=e.e,r=e.x;void 0!==i&&(i.x=r,e.e=void 0),void 0!==r&&(r.e=i,e.x=void 0),e===this.t&&(this.t=r,void 0===r&&ej(function(){var e;null==(e=t.Z)||e.call(t)}))}},eK.prototype.subscribe=function(e){var t=this;return e2(function(){var i=t.value,r=eU;eU=void 0;try{e(i)}finally{eU=r}})},eK.prototype.valueOf=function(){return this.value},eK.prototype.toString=function(){return this.value+""},eK.prototype.toJSON=function(){return this.value},eK.prototype.peek=function(){var e=eU;eU=void 0;try{return this.value}finally{eU=e}},Object.defineProperty(eK.prototype,"value",{get:function(){var e=eG(this);return void 0!==e&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ez>100)throw Error("Cycle detected");this.v=e,this.i++,eQ++,eF++;try{for(var t=this.t;void 0!==t;t=t.x)t.t.N()}finally{eB()}}}}),eX.prototype=new eK,eX.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f)||(this.f&=-5,this.g===eQ))return!0;if(this.g=eQ,this.f|=1,this.i>0&&!eq(this))return this.f&=-2,!0;var e=eU;try{eW(this),eU=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return eU=e,eJ(this),this.f&=-2,!0},eX.prototype.S=function(e){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}eK.prototype.S.call(this,e)},eX.prototype.U=function(e){if(void 0!==this.t&&(eK.prototype.U.call(this,e),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},eX.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;void 0!==e;e=e.x)e.t.N()}},Object.defineProperty(eX.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var e=eG(this);if(this.h(),void 0!==e&&(e.i=this.i),16&this.f)throw this.v;return this.v}}),e1.prototype.c=function(){var e=this.S();try{if(8&this.f||void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{e()}},e1.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,eZ(this),eW(this),eF++;var e=eU;return eU=this,e0.bind(this,e)},e1.prototype.N=function(){2&this.f||(this.f|=2,this.o=eH,eH=this)},e1.prototype.d=function(){this.f|=8,1&this.f||eY(this)},e1.prototype.dispose=function(){this.d()};class e4{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return 0===this.items.length?null:this.items.shift()}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}}let e5={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5},e6="ERROR";class e3{constructor(e="LOG",t="",i=console){this.minLogLevel=e5[e],this.scope=t,this.logProvider=i}log(...e){this.outputLog("LOG",e)}info(...e){this.outputLog("INFO",e)}debug(...e){this.outputLog("DEBUG",e)}warn(...e){this.outputLog("WARN",e)}error(...e){this.outputLog("ERROR",e)}outputLog(e,t){this.minLogLevel<=e5[e]&&this.logProvider[e.toLowerCase()]?.(...this.formatLogData(t))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=e5[e],void 0===this.minLogLevel&&(this.minLogLevel=e5.LOG)}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t="%c RS SDK";this.scope&&(t=`${t} - ${this.scope}`);let i=S(e[0])?e[0].trim():"",r=[t=`${t} %c ${i}`,"font-weight: bold; background: black; color: white;","font-weight: normal;"];return S(e[0])||r.push(e[0]),r.push(...e.slice(1)),r}return e}}let e8=new e3,e9=function(e){return e.HANDLEDEXCEPTION="handledException",e.UNHANDLEDEXCEPTION="unhandledException",e.UNHANDLEDREJECTION="unhandledPromiseRejection",e}({}),e7=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],te="cookieStorage",tt="Unable to process/parse source configuration response",ti="Failed to log breadcrumb",tr="Failed to fetch the source config",tn=e=>`${e}:: The provided callback parameter is not a function.`,ts="Failed to set/remove cookies via server. As a fallback, the cookies will be managed client side.",ta={All:!0},to="js-integrations",tl=RegExp("^(https?:\\/\\/)(((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|localhost|((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$"),tu="modern",tc="https://cdn.rudderlabs.com",td=`${tc}/v3/${tu}/${to}`,th=`${tc}/v3/${tu}/plugins`,tg="https://api.rudderstack.com",tp={iubenda:"IubendaConsentManager",oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},tf={v3:"StorageEncryption",legacy:"StorageEncryptionLegacy"},tv={xhr:"XhrQueue",beacon:"BeaconQueue"},ty=eV(v({configUrl:tg,loadIntegration:!0,sessions:{autoTrack:!0,timeout:18e5,cutOff:{enabled:!1}},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:ta,useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!0,lockPluginsVersion:!0,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:1e4,storage:{encryption:{version:"v3"},migrate:!0,cookie:{}},sendAdblockPage:!1,sameDomainCookiesOnly:!1,secureCookie:!1,sendAdblockPageOptions:{},useServerSideCookies:!1})),tm=_({userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null}),tb=_({entries:{userId:!0,userTraits:!0,groupId:!0,groupTraits:!0,sessionInfo:!0,authToken:!0,anonymousId:!1,initialReferrer:!1,initialReferringDomain:!1}}),tE={userId:eV(tm.userId),userTraits:eV(tm.userTraits),anonymousId:eV(tm.anonymousId),groupId:eV(tm.groupId),groupTraits:eV(tm.groupTraits),initialReferrer:eV(tm.initialReferrer),initialReferringDomain:eV(tm.initialReferringDomain),sessionInfo:eV(tm.sessionInfo),authToken:eV(tm.authToken)},tI={isOnline:eV(!0),storage:{isLocalStorageAvailable:eV(!1),isCookieStorageAvailable:eV(!1),isSessionStorageAvailable:eV(!1)},isBeaconAvailable:eV(!1),isLegacyDOM:eV(!1),isUaCHAvailable:eV(!1),isCryptoAvailable:eV(!1),isIE11:eV(!1),isAdBlockerDetectionInProgress:eV(!1),isAdBlocked:eV(void 0),cspBlockedURLs:eV([])},tk={isErrorReportingEnabled:eV(!1),isMetricsReportingEnabled:eV(!1),breadcrumbs:eV([])},tS=eV(void 0),tA={activeDataplaneUrl:eV(void 0),integrationsCDNPath:eV(td),pluginsCDNPath:eV(th),sourceConfigUrl:eV(void 0),status:eV(void 0),initialized:eV(!1),logLevel:eV(e6),loaded:eV(!1),readyCallbacks:eV([]),writeKey:eV(void 0),dataPlaneUrl:eV(void 0),safeAnalyticsInstance:eV(void 0)},tT={enabled:eV(!1),initialized:eV(!1),data:eV({}),activeConsentManagerPluginName:eV(void 0),preConsent:eV({enabled:!1}),postConsent:eV({}),resolutionStrategy:eV("and"),provider:eV(void 0),metadata:eV(void 0)},tw={retries:eV(0),dropped:eV(0),sent:eV(0),queued:eV(0),triggered:eV(0),metricsServiceUrl:eV(void 0)},tC={app:eV({name:ek,namespace:"com.rudderlabs.javascript",version:eS,installType:"npm"}),traits:eV(null),library:eV({name:ek,version:eS,snippetVersion:globalThis.RudderSnippetVersion}),userAgent:eV(null),device:eV(null),network:eV(null),os:eV({name:"",version:""}),locale:eV(null),screen:eV({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":eV(void 0),timezone:eV(void 0)},tD={configuredDestinations:eV([]),activeDestinations:eV([]),loadOnlyIntegrations:eV({}),failedDestinations:eV([]),loadIntegration:eV(!0),initializedDestinations:eV([]),clientDestinationsReady:eV(!1),integrationsConfig:eV({})},tP={toBeProcessedArray:eV([]),readyCallbacksArray:eV([])},tO={ready:eV(!1),loadedPlugins:eV([]),failedPlugins:eV([]),pluginsToLoadFromConfig:eV([]),activePlugins:eV([]),totalPluginsToLoad:eV(0)},tR={encryptionPluginName:eV(void 0),migrate:eV(!1),type:eV(void 0),cookie:eV(void 0),entries:eV({}),trulyAnonymousTracking:eV(!1)},tx={isEnabledServerSideCookies:eV(!1),dataServiceUrl:eV(void 0)},t$={eventsQueuePluginName:eV(void 0),deliveryEnabled:eV(!0)},tM={...v({capabilities:tI,consents:tT,context:tC,eventBuffer:tP,lifecycle:tA,loadOptions:ty,metrics:tw,nativeDestinations:tD,plugins:tO,reporting:tk,session:tE,source:tS,storage:tR,serverCookies:tx,dataPlaneEvents:t$,autoTrack:{enabled:eV(!1),pageLifecycle:{enabled:eV(!1),pageViewId:eV(void 0),pageLoadedTimestamp:eV(void 0)}}})};function tN(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t_={exports:{}},tB={exports:{}};tB.exports,t_.exports;let tL=tN(function(){var e,t,i,r;if(c)return t_.exports;return c=1,e=function(){return u?tB.exports:(u=1,tB.exports=function(){function e(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var i=["isConstructor","isEval","isNative","isToplevel"],r=["columnNumber","lineNumber"],n=["fileName","functionName","source"],s=i.concat(r,n,["args"],["evalOrigin"]);function a(t){if(t)for(var i=0;i<s.length;i++)void 0!==t[s[i]]&&this["set"+e(s[i])](t[s[i]])}a.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof a)this.evalOrigin=e;else if(e instanceof Object)this.evalOrigin=new a(e);else throw TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",i=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+i+")":"[eval]:"+t+":"+i:r?r+" ("+e+":"+t+":"+i+")":e+":"+t+":"+i}},a.fromString=function(e){var t=e.indexOf("("),i=e.lastIndexOf(")"),r=e.substring(0,t),n=e.substring(t+1,i).split(","),s=e.substring(i+1);if(0===s.indexOf("@"))var o=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(s,""),l=o[1],u=o[2],c=o[3];return new a({functionName:r,args:n||void 0,fileName:l,lineNumber:u||void 0,columnNumber:c||void 0})};for(var o=0;o<i.length;o++)a.prototype["get"+e(i[o])]=t(i[o]),a.prototype["set"+e(i[o])]=function(e){return function(t){this[e]=!!t}}(i[o]);for(var l=0;l<r.length;l++)a.prototype["get"+e(r[l])]=t(r[l]),a.prototype["set"+e(r[l])]=function(e){return function(t){if(!(!isNaN(parseFloat(t))&&isFinite(t)))throw TypeError(e+" must be a Number");this[e]=Number(t)}}(r[l]);for(var u=0;u<n.length;u++)a.prototype["get"+e(n[u])]=t(n[u]),a.prototype["set"+e(n[u])]=function(e){return function(t){this[e]=String(t)}}(n[u]);return a}(),tB.exports)}(),t=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,r=/^(eval@)?(\[native code])?$/,t_.exports={parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(i))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter(function(e){return!!e.match(i)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var i=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=i.match(/ (\(.+\)$)/);i=r?i.replace(r[0],""):i;var n=this.extractLocation(r?r[1]:i);return new e({functionName:r&&i||void 0,fileName:["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0],lineNumber:n[1],columnNumber:n[2],source:t})},this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter(function(e){return!e.match(r)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var i=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(i),n=r&&r[1]?r[1]:void 0,s=this.extractLocation(t.replace(i,""));return new e({functionName:n,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:t})},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var i=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),n=[],s=2,a=r.length;s<a;s+=2){var o=i.exec(r[s]);o&&n.push(new e({fileName:o[2],lineNumber:o[1],source:r[s]}))}return n},parseOpera10:function(t){for(var i=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),n=[],s=0,a=r.length;s<a;s+=2){var o=i.exec(r[s]);o&&n.push(new e({functionName:o[3]||void 0,fileName:o[2],lineNumber:o[1],source:r[s]}))}return n},parseOpera11:function(i){return i.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var i,r=t.split("@"),n=this.extractLocation(r.pop()),s=r.shift()||"",a=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return s.match(/\(([^)]*)\)/)&&(i=s.replace(/^[^(]+\(([^)]*)\)$/,"$1")),new e({functionName:a,args:void 0===i||"[arguments not available]"===i?void 0:i.split(","),fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:t})},this)}},t_.exports}()),tU="global code",tj=e=>S(e)?e:"";function tH(e,t,i,r){return{errorClass:tj(e),message:`${i}${tj(t)}`,type:"browserjs",stacktrace:r.reduce((e,t)=>{let i=(e=>{let t,i={file:e.fileName,method:A(t=e.functionName)&&/^global code$/i.test(t)?tU:t,lineNumber:e.lineNumber,columnNumber:e.columnNumber};return i.lineNumber&&i.lineNumber>-1&&!i.file&&!i.method&&(i.file=tU),i})(t);try{if("{}"===JSON.stringify(i))return e;return e.concat(i)}catch{return e}},[])}}let tF=(e,t)=>{let i;if(w(e)&&S(eb(e)))i=e;else{let r;t.warn((r=ef(e),`${Z}:: Ignoring a non-error: ${r}.`)),i=void 0}return i},tz=(e,t)=>{try{return JSON.parse(e||"")}catch(e){t(eE(e,"Failed to parse response data"))}},tQ="The request failed",tG=[RegExp(`${tQ}.*`),/A script with the id .* is already loaded\./],tK=[/Failed to fetch dynamically imported module: .*/,/Unable to load \(.*\) the script with the id .*/,/A timeout of \d+ ms occurred while trying to load the script with id .*/],tV={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},tq=(e,t,i)=>{let r=O(tV,t||{});return i&&(r.headers=O(r.headers,{Authorization:i})),r.url=e,r},tW=(e,t=eP,i)=>new Promise((r,n)=>{let s;if(!0===e.sendRawData)s=e.data;else if(null===(s=ef(e.data,!1,[],i)))return void n({error:Error("Failed to prepare data for the request."),undefined,options:e});let a=new XMLHttpRequest,o=t=>{n({error:Error(((e,t,i)=>`${e} due to timeout or no connection (${t?t.type:""}) at the client side for URL: ${i}`)(tQ,t,e.url)),xhr:a,options:e,...t?.type==="timeout"?{timedOut:!0}:{}})};a.ontimeout=o,a.onerror=o,a.onload=()=>{a.status>=200&&a.status<400?r({response:a.responseText,xhr:a,options:e}):(t=>{let i,r,s,o;n({error:Error((i=a.status,r=a.statusText,s=e.url,o=a.responseText,`${tQ} with status ${i} (${r}) for URL: ${s}. Response: ${o.trim()}`)),xhr:a,options:e})})()},a.open(e.method,e.url,!0),!0===e.withCredentials&&(a.withCredentials=!0),a.timeout=t,Object.keys(e.headers).forEach(t=>{e.headers[t]&&a.setRequestHeader(t,e.headers[t])});try{a.send(s)}catch(i){let t;n({error:eE(i,(t=e.url,`${tQ} for URL: ${t}`)),xhr:a,options:e})}});class tJ{constructor(e){this.logger=e,this.onError=this.onError.bind(this)}init(e){this.errorHandler=e}async getData(e){let{url:t,options:i,timeout:r,isRawResponse:n}=e;try{let e=await tW(tq(t,i,this.basicAuthHeader),r,this.logger);return{data:n?e.response:tz(e.response,this.onError),details:e}}catch(e){return{data:void 0,details:e}}}getAsyncData(e){let{callback:t,url:i,options:r,timeout:n,isRawResponse:s}=e,a=!k(t);tW(tq(i,r,this.basicAuthHeader),n,this.logger).then(e=>{a||t(s?e.response:tz(e.response,this.onError),e)}).catch(e=>{a||t(void 0,e)})}onError(e,t){this.errorHandler?.onError({error:e,context:"HttpClient",groupingHash:t})}setAuthHeader(e,t=!1){let i=t?e:U(`${e}:`);this.basicAuthHeader=`Basic ${i}`}resetAuthHeader(){this.basicAuthHeader=void 0}}let tX=new tJ(e8),tZ=["www.test-host.com","localhost","127.0.0.1","[::1]"],tY=["userId","userTraits","groupId","groupTraits","anonymousId","config","integration","eventBuffer","traits","authToken"],t0=e=>{tM.capabilities.isAdBlockerDetectionInProgress.value=!0;try{let t=new URL(tM.lifecycle.sourceConfigUrl.value),i=`${t.origin}${t.pathname}?view=ad`;e.getAsyncData({url:i,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(e,t)=>{tM.capabilities.isAdBlockerDetectionInProgress.value=!1,tM.capabilities.isAdBlocked.value=t?.error!==void 0||t?.xhr?.responseURL!==i}})}catch(e){throw tM.capabilities.isAdBlockerDetectionInProgress.value=!1,e}};class t1{initialized=!1;constructor(e,t){this.httpClient=e,this.logger=t}init(){this.initialized||(this.attachErrorListeners(),this.initialized=!0)}attachErrorListeners(){globalThis.addEventListener("error",e=>{this.onError({error:e,context:Z,errorType:e9.UNHANDLEDEXCEPTION})}),globalThis.addEventListener("unhandledrejection",e=>{this.onError({error:e,context:Z,errorType:e9.UNHANDLEDREJECTION})}),document.addEventListener("securitypolicyviolation",e=>{let t=S(e.blockedURI)?e.blockedURI:"";"enforce"===e.disposition&&t.startsWith(tc)&&!tM.capabilities.cspBlockedURLs.value.includes(t)&&(tM.capabilities.cspBlockedURLs.value=[...tM.capabilities.cspBlockedURLs.value,t])})}async onError(e){try{let{error:t,context:i,customMessage:r,groupingHash:n,category:s}=e,a=e.errorType??e9.HANDLEDEXCEPTION,o=((e,t)=>{switch(t){case e9.UNHANDLEDEXCEPTION:{let{error:t}=e;return t||e}case e9.UNHANDLEDREJECTION:return e.reason;case e9.HANDLEDEXCEPTION:default:return e}})(t,a),l=tF(o,this.logger);if(void 0===l)return;let u=r?`${r} - `:"",c=`${i}:: ${u}`,d=((e,t)=>{try{let i=tL.parse(e);return tH(e.name,e.message,t,i)}catch{return tH(e.name,e.message,t,[])}})(l,c),h=eb(l).includes(em);if(!h&&!(e=>{let t=e.stacktrace[0]?.file;if(!t||"string"!=typeof t)return!1;let i=t.substring(t.lastIndexOf("/")+1),r=t.split("/");return r[r.length-2]===to||["rsa"].some(e=>i.startsWith(e)&&i.endsWith(".js"))})(d)&&a!==e9.HANDLEDEXCEPTION)return;if(tM.reporting.isErrorReportingEnabled.value&&await ((e,t,i)=>{let r=e.message;return new Promise(e=>{if(tK.some(e=>e.test(r))){let n=/https?:\/\/[^\s"'(),;<>[\]{}]+/.exec(r)?.[0];S(n)?n.startsWith(tc)?t.capabilities.cspBlockedURLs.value.includes(n)?e(!1):((e,t,i)=>{if(void 0===e.capabilities.isAdBlocked.value){!1===e.capabilities.isAdBlockerDetectionInProgress.value&&t0(t);let r=e2(()=>{A(e.capabilities.isAdBlocked.value)&&(i(!1===e.capabilities.isAdBlocked.value),r())})}else i(!1===e.capabilities.isAdBlocked.value)})(t,i,e):e(!1):e(!0)}else e(!tG.some(e=>e.test(r)))})})(d,tM,this.httpClient)){let e={severity:"error",unhandled:a!==e9.HANDLEDEXCEPTION,severityReason:{type:a}},t=((e,t,i,r)=>{let n;if("cdn"!==i.context.app.value.installType)return n;if(A(e))if(S(e))n=e;else{let i=tF(e,r);n=A(i)?i.message:t}else n=t;return n})(n,d.message,tM,this.logger),i=((e,t,i,r)=>{let n,s,a,o,{context:l,lifecycle:u,session:c,source:d,reporting:h,autoTrack:g}=i,{app:p,locale:f,userAgent:y,timezone:m,screen:b,library:E}=l;return{payloadVersion:"5",notifier:{name:"RudderStack JavaScript SDK",version:p.value.version,url:"git+https://github.com/rudderlabs/rudder-sdk-js.git"},events:[{exceptions:[v(e)],severity:t.severity,unhandled:t.unhandled,severityReason:t.severityReason,app:{version:p.value.version,releaseStage:((e=()=>window.location.hostname)=>{let t=e();return!t||t&&tZ.includes(t)?"development":"production"})(),type:p.value.installType},device:{locale:f.value??"NA",userAgent:y.value??"NA",time:new Date},request:{url:globalThis.location.href.split("?")[0],clientIp:"[NOT COLLECTED]"},breadcrumbs:v(h.breadcrumbs.value),context:e.message,groupingHash:r,metaData:{app:{snippetVersion:E.value.snippetVersion},device:{...b.value,timezone:m.value},...(e=>{let t=ef(e,!1,tY);return null!==t?JSON.parse(t):{}})(i)},user:(n=d,s=c,a=u,o=g,{id:`${n.value?.id??a.writeKey.value}..${s.sessionInfo.value.id??"NA"}..${o.pageLifecycle.pageViewId.value??"NA"}`,name:n.value?.name??"NA"})}]}})(d,e,tM,t);this.httpClient.getAsyncData({url:tM.metrics.metricsServiceUrl.value,options:{method:"POST",data:ef({version:"1",message_id:el(),source:{name:"js",sdk_version:tM.context.app.value.version,write_key:tM.lifecycle.writeKey.value,install_type:tM.context.app.value.installType,category:s??"sdk"},errors:i}),sendRawData:!0},isRawResponse:!0})}(a===e9.HANDLEDEXCEPTION||h)&&this.logger.error(d.message)}catch(e){this.logger.error(`${Z}:: Failed to handle the error.`,e)}}leaveBreadcrumb(e){try{tM.reporting.breadcrumbs.value=[...tM.reporting.breadcrumbs.value,{type:"manual",name:e,timestamp:new Date,metaData:{}}]}catch(e){this.onError({error:e,context:Z,customMessage:ti,groupingHash:ti})}}}let t2=new t1(tX,e8);class t4{plugins=[];byName={};cache={};config={throws:!0};constructor(e,t={}){this.config={throws:!0,...t},this.logger=e}register(e,t){if(!e.name){let t=`${Y}:: Plugin name is missing.`;if(!this.config.throws)return void this.logger.error(t,e);throw Error(t)}if(this.byName[e.name]){let t,i=(t=e.name,`${Y}:: Plugin "${t}" already exists.`);if(!this.config.throws)return void this.logger.error(i);throw Error(i)}this.cache={},this.plugins=this.plugins.slice();let i=this.plugins.length;this.plugins.forEach((t,r)=>{t.deps?.includes(e.name)&&(i=Math.min(i,r))}),this.plugins.splice(i,0,e),this.byName[e.name]=e,k(e.initialize)&&e.initialize(t)}unregister(e){let t=this.byName[e];if(!t){let t=`${Y}:: Plugin "${e}" not found.`;if(!this.config.throws)return void this.logger.error(t);throw Error(t)}let i=this.plugins.indexOf(t);if(-1===i){let t=`${Y}:: Plugin "${e}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`;if(!this.config.throws)return void this.logger.error(t);throw Error(t)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(i,1)}getPlugin(e){return this.byName[e]}getPlugins(e){let t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter(e=>{if(e.deps?.some(e=>!this.byName[e])){let t,i=e.deps.filter(e=>!this.byName[e]);return this.logger.error((t=e.name,`${Y}:: Plugin "${t}" could not be loaded because some of its dependencies "${i}" do not exist.`)),!1}return"."===t||!!C(e,t)})),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e,t=!0,...i){let r=e;if(!r)throw Error("Failed to invoke plugin because the extension point name is missing.");let n=r.startsWith("!"),s=this.config.throws??r.endsWith("!");if(!(r=r.replace(/(^!|!$)/g,"")))throw Error("Failed to invoke plugin because the extension point name is invalid.");let a=r.split(".");a.pop();let o=a.join(".");return(t?this.getPlugins(r):[this.getPlugins(r)[0]]).map(e=>{let t=C(e,r);if(!k(t)||n)return t;try{return t.apply(C(e,o),i)}catch(n){let t,i;if(s)throw n;this.logger.error((t=r,i=e.name,`${Y}:: Failed to invoke the "${t}" extension point of plugin "${i}".`),n)}return null})}invokeSingle(e,...t){return this.invoke(e,!1,...t)[0]}invokeMultiple(e,...t){return this.invoke(e,!0,...t)}}let t5=new t4(e8,{throws:!0}),t6=e=>"cloud"!==e.config.connectionMode||!0===e.config.useNativeSDKToSend||!0===e.config.useNativeSDK,t3=e=>"hybrid"===e.config.connectionMode||!0===e.config.useNativeSDKToSend,t8=e=>e.filter(t6),t9=["BeaconQueue","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],t7=["Bugsnag","ErrorReporting"],ie="cookieStorage",it="localStorage",ii="sessionStorage",ir="memoryStorage",is="none",ia=e=>e.replace(/\/{2,}/g,"/"),io=e=>{if(!S(e))return!1;try{return k(globalThis.URL)&&new URL(e),tl.test(e)}catch(e){return!1}},il=e=>429===e||!(e>=400&&e<500),iu=(e,t)=>{try{return encodeURIComponent(e)}catch(e){t?.error("Failed to encode the cookie data.",e);return}},ic=e=>{try{return decodeURIComponent(e)}catch(e){return}},id=()=>(e=>{let t,i={},r=e.split(/\s*;\s*/);return r[0]&&r.forEach(e=>{let r=(t=e.split("="))[0]?ic(t[0]):void 0;r&&(i[r]=t[1]?ic(t[1]):void 0)}),i})(globalThis.document.cookie),ih=function(e,t,i,r){switch(arguments.length){case 4:case 3:case 2:let n={...i||{}},s=`${iu(e,r)}=${iu(t,r)}`;null===t&&(n.maxage=-1),n.maxage&&(n.expires=new Date(+new Date+n.maxage)),n.path&&(s+=`; path=${n.path}`),n.domain&&(s+=`; domain=${n.domain}`),n.expires&&(s+=`; expires=${n.expires.toUTCString()}`),n.samesite&&(s+=`; samesite=${n.samesite}`),n.secure&&(s+="; secure"),globalThis.document.cookie=s;return;case 1:if(e)return id()[e];return id();default:return id()}},ig={userId:"rl_user_id",userTraits:"rl_trait",anonymousId:"rl_anonymous_id",groupId:"rl_group_id",groupTraits:"rl_group_trait",initialReferrer:"rl_page_init_referrer",initialReferringDomain:"rl_page_init_referring_domain",sessionInfo:"rl_session",authToken:"rl_auth_token"},ip="RS_ENC_v3_",iv=e=>e?.startsWith(ip)?j(e.substring(ip.length)):e,iy="client-network",im="integrations",ib="QueueUtilities",iE=(e,t)=>ef(e,!0,void 0,t),iI=(e,t)=>{let i=iE(e,t);if(i){let e=i.length;e>32768&&t?.warn(`${ib}:: The size of the event payload (${e} bytes) exceeds the maximum limit of 32768 bytes. Events with large payloads may be dropped in the future. Please review your instrumentation to ensure that event payloads are within the size limit.`)}else t?.warn(`${ib}:: Failed to validate event payload size. Please make sure that the event payload is within the size limit and is a valid JSON object.`)},ik=(e,t)=>{let i=v(e);return i.sentAt=t,i},iS={IN_PROGRESS:"inProgress",QUEUE:"queue",RECLAIM_START:"reclaimStart",RECLAIM_END:"reclaimEnd",ACK:"ack",BATCH_QUEUE:"batchQueue"},iA=(e,t)=>`${e}:: ${iT(t)}`,iT=e=>`Failed to send events batch data to the browser's beacon queue for URL ${e}.`,iw={maxItems:10,flushQueueInterval:6e5},iC="BeaconQueuePlugin",iD=(e,t,i)=>{try{let r=ef({batch:e,sentAt:t},!0);if(r)return new Blob([r],{type:"text/plain"});i?.error(`${iC}:: Failed to convert events batch object to string.`)}catch(e){i?.error(`${iC}:: Failed to convert events batch object to Blob.`,e)}},iP=function(e){return e[e.ASAP=1]="ASAP",e[e.RESCHEDULE=2]="RESCHEDULE",e[e.ABANDON=3]="ABANDON",e}({}),iO={setTimeout:(e,t)=>globalThis.setTimeout(e,t),clearTimeout:e=>globalThis.clearTimeout(e),Date:globalThis.Date,clockLateFactor:2};class iR{constructor(){this.tasks={},this.nextId=1,this.clock=iO}now(){return+new this.clock.Date}run(e,t,i){this.nextId===Number.MAX_SAFE_INTEGER&&(this.nextId=1);let r=(this.nextId++).toString();return this.tasks[r]=this.clock.setTimeout(this.handle(r,e,t,i||iP.ASAP),t),r}handle(e,t,i,r){let n=this.now();return()=>{delete this.tasks[e];let s=n+i*(this.clock.clockLateFactor||2),a=this.now();if(r>=iP.RESCHEDULE&&s<a){r===iP.RESCHEDULE&&this.run(t,i,r);return}return t()}}cancel(e){this.tasks[e]&&(this.clock.clearTimeout(this.tasks[e]),delete this.tasks[e])}cancelAll(){Object.values(this.tasks).forEach(this.clock.clearTimeout),this.tasks={}}}let ix=1/0,i$=1/0,iM="Batch",iN="Single",i_=(e,t)=>e.time-t.time,iB="RetryQueue";class iL{constructor(e,t,i,r,n=it,s,a){this.storeManager=r,this.logger=s,this.name=e,this.id=el(),this.processQueueCb=i,this.batchSizeCalcCb=a,this.maxItems=t.maxItems||i$,this.maxAttempts=t.maxAttempts||ix,this.batch={enabled:!1},this.configureBatchMode(t),this.backoff={minRetryDelay:t.minRetryDelay||1e3,maxRetryDelay:t.maxRetryDelay||3e4,factor:t.backoffFactor||2,jitter:t.backoffJitter||0};let o=Math.max(t.timerScaleFactor??1,1);o=Math.min(o,10),this.timeouts={ackTimer:Math.round(1e3*o),reclaimTimer:Math.round(3e3*o),reclaimTimeout:Math.round(1e4*o),reclaimWait:Math.round(500*o)},this.schedule=new iR,this.processId="0",this.store=this.storeManager.setStore({id:this.id,name:this.name,validKeys:iS,type:n,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}),this.setDefaultQueueEntries(),this.ack=this.ack.bind(this),this.checkReclaim=this.checkReclaim.bind(this),this.processHead=this.processHead.bind(this),this.flushBatch=this.flushBatch.bind(this),this.isPageAccessible=!0,this.flushBatchOnPageLeave(),this.scheduleTimeoutActive=!1}setDefaultQueueEntries(){this.setStorageEntry(iS.IN_PROGRESS,{}),this.setStorageEntry(iS.QUEUE,[]),this.setStorageEntry(iS.BATCH_QUEUE,[])}configureBatchMode(e){if(this.batchingInProgress=!1,!D(e.batch))return;let t=e.batch;this.batch.enabled=!0===t.enabled,this.batch.enabled&&(this.batch.maxSize=Math.min(t.maxSize??524288,524288),this.batch.maxItems=t.maxItems??100,this.batch.flushInterval=t.flushInterval??6e4)}flushBatchOnPageLeave(){this.batch.enabled&&ec(this.flushBatch)}getStorageEntry(e){return this.store.get(e)}setStorageEntry(e,t){null==t?this.store.remove(e):this.store.set(e,t)}stop(){this.schedule.cancelAll(),this.scheduleTimeoutActive=!1}start(){this.scheduleTimeoutActive&&this.stop(),this.scheduleTimeoutActive=!0,this.scheduleFlushBatch(),this.ack(),this.checkReclaim(),this.processHead()}scheduleFlushBatch(){this.batch.enabled&&this.batch?.flushInterval&&(this.flushBatchTaskId&&this.schedule.cancel(this.flushBatchTaskId),this.flushBatchTaskId=this.schedule.run(this.flushBatch,this.batch.flushInterval,iP.ASAP))}flushBatch(e=!0){if(!this.batchingInProgress){this.isPageAccessible=e,this.batchingInProgress=!0;let t=this.getStorageEntry(iS.BATCH_QUEUE)??[];if(t.length>0){t=t.slice(-t.length);let e=this.genQueueItem(t.map(e=>e.item),iM);this.setStorageEntry(iS.BATCH_QUEUE,[]),this.pushToMainQueue(e)}this.batchingInProgress=!1,this.scheduleFlushBatch()}}shouldRetry(e,t){return t<=this.maxAttempts}getDelay(e){let t=this.backoff.minRetryDelay*this.backoff.factor**e;if(this.backoff.jitter){let e=Math.random(),i=Math.floor(e*this.backoff.jitter*t);5>Math.floor(10*e)?t-=i:t+=i}return Number(Math.min(t,this.backoff.maxRetryDelay).toPrecision(1))}enqueue(e){let t;(t=this.batch.enabled&&e.type===iN?this.handleNewItemForBatch(e):e)&&this.pushToMainQueue(t)}handleNewItemForBatch(e){let t,i=this.getStorageEntry(iS.BATCH_QUEUE)??[];if(this.batchingInProgress)i.push(e);else{this.batchingInProgress=!0,(i=i.slice(-i.length)).push(e);let r=this.getBatchDispatchInfo(i);if(r.criteriaMet||r.criteriaExceeded){let n;if(r.criteriaExceeded?(n=i.slice(0,i.length-1),i=[e]):(n=i,i=[]),n.length>0){let e=n.every(e=>e.reclaimed),i=n.map(e=>e.item);t=e?this.genQueueItem(i,iM,!0):this.genQueueItem(i,iM)}this.scheduleFlushBatch()}this.batchingInProgress=!1}return this.setStorageEntry(iS.BATCH_QUEUE,i),t}pushToMainQueue(e){let t=this.getStorageEntry(iS.QUEUE)??[];(t=this.maxItems>1?t.slice(-(this.maxItems-1)):[]).push(e),t=t.sort(i_),this.setStorageEntry(iS.QUEUE,t),this.scheduleTimeoutActive&&this.processHead()}addItem(e){this.enqueue(this.genQueueItem(e))}genQueueItem(e,t=iN,i){return{item:e,attemptNumber:0,time:this.schedule.now(),id:el(),type:t,...A(i)?{reclaimed:i}:{}}}requeue(e){let{attemptNumber:t,item:i,type:r,id:n,firstAttemptedAt:s,lastAttemptedAt:a,reclaimed:o,retryReason:l}=e,u=t+1;this.shouldRetry(i,u)&&this.enqueue({item:i,attemptNumber:u,time:this.schedule.now()+this.getDelay(u),id:n??el(),type:r,firstAttemptedAt:s,lastAttemptedAt:a,reclaimed:o,retryReason:l})}getBatchDispatchInfo(e){let t=!1,i=!1,r=this.batch?.maxItems;if(A(r)&&(t=e.length===r,i=e.length>r),t||i)return{criteriaMet:t,criteriaExceeded:i};let n=!1,s=!1,a=this.batch?.maxSize;if(A(a)&&A(this.batchSizeCalcCb)){let t=this.batchSizeCalcCb(e.map(e=>e.item));n=t===a,s=t>a}return{criteriaMet:n,criteriaExceeded:s}}processHead(){this.schedule.cancel(this.processId);let e=this.getStorageEntry(iS.QUEUE)??[],t=this.schedule.now(),i=[],r=(e,t)=>(i,r)=>{let n=this.getStorageEntry(iS.IN_PROGRESS)??{},s=n[t],a=s?.firstAttemptedAt,o=s?.lastAttemptedAt;delete n[t],this.setStorageEntry(iS.IN_PROGRESS,n),i&&this.requeue({...e,firstAttemptedAt:a,lastAttemptedAt:o,retryReason:r?.retryReason??iy})},n=(e,t)=>{i.push({id:t,item:e.item,done:r(e,t),attemptNumber:e.attemptNumber})},s=this.getStorageEntry(iS.IN_PROGRESS)??{},a=Object.keys(s).length;for(;e.length>0&&e[0].time<=t&&a++<this.maxItems;){let t=e.shift();if(t){let e=el();s[e]={item:t.item,attemptNumber:t.attemptNumber,time:this.schedule.now(),type:t.type,firstAttemptedAt:t.firstAttemptedAt,lastAttemptedAt:t.lastAttemptedAt,reclaimed:t.reclaimed},n(t,e)}}if(this.setStorageEntry(iS.QUEUE,e),this.setStorageEntry(iS.IN_PROGRESS,s),i.forEach(e=>{try{let t=this.schedule.now(),i=this.getStorageEntry(iS.IN_PROGRESS)??{},r=i[e.id],n=t,s=t,a=!1,o=iy;r&&(o=r.retryReason??o,n=r.firstAttemptedAt??n,s=r.lastAttemptedAt??s,a=r.reclaimed??a,r.firstAttemptedAt=n,r.lastAttemptedAt=t,i[e.id]=r,this.setStorageEntry(iS.IN_PROGRESS,i));let l=t-n,u=t-s,c=this.shouldRetry(e.item,e.attemptNumber+1);this.processQueueCb(e.item,e.done,{retryAttemptNumber:e.attemptNumber,maxRetryAttempts:this.maxAttempts,willBeRetried:c,timeSinceFirstAttempt:l,timeSinceLastAttempt:u,reclaimed:a,isPageAccessible:this.isPageAccessible,retryReason:o})}catch(r){let t,i="";e.attemptNumber<this.maxAttempts?(i="The item will be requeued.",e.attemptNumber>0&&(i=`${i} Retry attempt ${e.attemptNumber} of ${this.maxAttempts}.`),e.done(r)):(i=`Retries exhausted (${this.maxAttempts}). The item will be dropped.`,e.done()),this.logger?.error((t=i,`${iB}:: An unknown error occurred while processing the queue item. ${t}`),r)}}),e=this.getStorageEntry(iS.QUEUE)??[],this.schedule.cancel(this.processId),e.length>0){let i=e[0].time-t;this.processId=this.schedule.run(this.processHead,i,iP.ASAP)}}ack(){this.setStorageEntry(iS.ACK,this.schedule.now()),null!=this.reclaimStartVal&&(this.reclaimStartVal=null,this.setStorageEntry(iS.RECLAIM_START,null)),null!=this.reclaimEndVal&&(this.reclaimEndVal=null,this.setStorageEntry(iS.RECLAIM_END,null)),this.schedule.run(this.ack,this.timeouts.ackTimer,iP.ASAP)}reclaim(e){let t=this.storeManager.setStore({id:e,name:this.name,validKeys:iS,type:it,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}),i={queue:this.getStorageEntry(iS.QUEUE)??[]},r={inProgress:t.get(iS.IN_PROGRESS)??{},batchQueue:t.get(iS.BATCH_QUEUE)??[],queue:t.get(iS.QUEUE)??[]},n=[],s=(e,t)=>{let r=e=>{let r=e.id??el();if(n.includes(r));else{let s=Array.isArray(e.item)?iM:iN;i.queue.push({item:e.item,attemptNumber:e.attemptNumber+t,time:this.schedule.now(),id:r,type:e.type??s,firstAttemptedAt:e.firstAttemptedAt,lastAttemptedAt:e.lastAttemptedAt,retryReason:e.retryReason,reclaimed:!0}),n.push(r)}};Array.isArray(e)?e.forEach(r):e&&Object.values(e).forEach(r)};s(r.queue,0),this.batch.enabled?r.batchQueue.forEach(e=>{let t=e.id??el();n.includes(t)||(this.enqueue({...e,id:t,retryReason:e.retryReason,reclaimed:!0,type:e.type??iN,time:this.schedule.now()}),n.push(t))}):s(r.batchQueue,0),s(r.inProgress,1),i.queue.sort(i_),this.setStorageEntry(iS.QUEUE,i.queue),this.clearQueueEntries(t,1),this.processHead()}clearQueueEntries(e,t){this.removeStorageEntry(e,0,t)}removeStorageEntry(e,t,i,r=1){let n=Object.keys(iS),s=iS[n[t]];globalThis.setTimeout(()=>{try{e.remove(s),t+1<n.length&&this.removeStorageEntry(e,t+1,i)}catch(o){let a="NS_ERROR_STORAGE_BUSY";if((o.name===a||o.code===a||0x80630001===o.code)&&r<2)this.removeStorageEntry(e,t,i+40,r+1);else this.logger?.error(`${iB}:: Failed to remove local storage entry "${s}" (attempt: ${r}.`,o);2===r&&t+1<n.length&&this.removeStorageEntry(e,t+1,i)}},i)}checkReclaim(){let e=e=>()=>{e.get(iS.RECLAIM_END)===this.id&&e.get(iS.RECLAIM_START)===this.id&&this.reclaim(e.id)},t=t=>()=>{t.get(iS.RECLAIM_START)===this.id&&(t.set(iS.RECLAIM_END,this.id),this.schedule.run(e(t),this.timeouts.reclaimWait,iP.ABANDON))},i=e=>{e.set(iS.RECLAIM_START,this.id),e.set(iS.ACK,this.schedule.now()),this.schedule.run(t(e),this.timeouts.reclaimWait,iP.ABANDON)};(e=>{let t=[],i=this.store.getOriginalEngine(),r=[];if(k(i.keys))r=i.keys();else for(let e=0;e<i.length;e++){let t=i.key(e);t&&r.push(t)}return r.forEach(i=>{let r=i?i.split("."):[];r.length>=3&&r[0]===e&&r[1]!==this.id&&r[2]===iS.ACK&&t.push(this.storeManager.setStore({id:r[1],name:e,validKeys:iS,type:it,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}))}),t})(this.name).forEach(e=>{this.schedule.now()-e.get(iS.ACK)<this.timeouts.reclaimTimeout||i(e)}),this.schedule.run(this.checkReclaim,this.timeouts.reclaimTimer,iP.RESCHEDULE)}clear(){this.schedule.cancelAll(),this.setDefaultQueueEntries()}}let iU="BeaconQueue",ij="CustomConsentManager",iH="DeviceModeDestinationsPlugin",iF=e=>`Failed to initialize integration for destination "${e}".`,iz=e=>`Failed to get integrations data for destination "${e}".`,iQ=e=>`Failed to get the ready status from integration for destination "${e}"`,iG=(e,t)=>{let i=e.All??!0;return t.filter(t=>{let r,n=t.displayName;return i?(r=!0,(e=>void 0!==e&&!1==!!e)(e[n])&&(r=!1)):(r=!1,(e=>void 0!==e&&!0==!!e)(e[n])&&(r=!0)),r})},iK={HubSpot:"HubSpot","Google Analytics":"GA",Hotjar:"Hotjar","Google Ads":"GoogleAds",VWO:"VWO","Google Tag Manager":"GoogleTagManager",Braze:"Braze",Intercom:"INTERCOM",Keen:"Keen","Kiss Metrics":"Kissmetrics","Customer IO":"CustomerIO",Chartbeat:"Chartbeat","Facebook Pixel":"FacebookPixel",Lotame:"Lotame","Optimizely Web":"Optimizely",Bugsnag:"Bugsnag",Fullstory:"Fullstory",TVSquared:"TVSquared","Google Analytics 4 (GA4)":"GA4","Google Analytics 4 (GA4) V2":"GA4_V2",MoEngage:"MoEngage",Amplitude:"Amplitude",Pendo:"Pendo",Lytics:"Lytics",Appcues:"Appcues",PostHog:"Posthog",Klaviyo:"Klaviyo",CleverTap:"Clevertap","Bing Ads":"BingAds","Pinterest Tag":"PinterestTag","Adobe Analytics":"AdobeAnalytics","Linkedin Insight Tag":"LinkedInInsightTag","Reddit Pixel":"RedditPixel",Drip:"Drip","Heap.io":"Heap",Criteo:"Criteo",Mixpanel:"Mixpanel",Qualtrics:"Qualtrics",ProfitWell:"ProfitWell",Sentry:"Sentry","Quantum Metric":"QuantumMetric","Snap Pixel":"SnapPixel","Post Affiliate Pro":"PostAffiliatePro","Google Optimize":"GoogleOptimize",LaunchDarkly:"LaunchDarkly","Google Analytics 360":"GA360",Adroll:"Adroll","DCM Floodlight":"DCMFloodlight",Matomo:"Matomo",Vero:"Vero",Mouseflow:"Mouseflow",Rockerbox:"Rockerbox",Convertflow:"ConvertFlow",SnapEngage:"SnapEngage",livechat:"LiveChat",Shynet:"Shynet",WOOPRA:"Woopra",rollbar:"RollBar","Quora Pixel":"QuoraPixel",JUNE:"June",Engage:"Engage",Iterable:"Iterable","Yandex.Metrica":"YandexMetrica",Refiner:"Refiner",Qualaroo:"Qualaroo",Podsights:"Podsights",Axeptio:"Axeptio",SatisMeter:"Satismeter","Microsoft Clarity":"MicrosoftClarity",Sendinblue:"Sendinblue",Olark:"Olark","Lemnisk Marketing Automation":"Lemnisk","TikTok Ads":"TiktokAds",ActiveCampaign:"ActiveCampaign",Sprig:"Sprig","Spotify Pixel":"SpotifyPixel",CommandBar:"CommandBar",Ninetailed:"Ninetailed","Gainsight PX":"Gainsight_PX",XPixel:"XPixel",Userpilot:"Userpilot",Comscore:"Comscore"},iV=(e,t=0)=>new Promise((i,r)=>{if(e.integration?.isReady())i(!0);else if(t>=11e3)r(Error("A timeout of 11000 ms occurred"));else{let n=Date.now();new Promise(e=>{globalThis.setTimeout(e,100)}).then(()=>{iV(e,t+(Date.now()-n)).then(i).catch(e=>r(e))})}}),iq=(e,t,i,r,n,s)=>{try{let s,a=v(e),o=a.integration;s=o,void 0===s&&(a.integration=o=((e,t,i,r)=>{let n={loadIntegration:r.nativeDestinations.loadIntegration.value,logLevel:r.lifecycle.logLevel.value,loadOnlyIntegrations:r.consents.postConsent.value?.integrations??r.nativeDestinations.loadOnlyIntegrations.value,...r.lifecycle.safeAnalyticsInstance.value};return new globalThis[e][t](v(i.config),n,{shouldApplyDeviceModeTransformation:i.shouldApplyDeviceModeTransformation,propagateEventsUntransformedOnError:i.propagateEventsUntransformedOnError,destinationId:i.id})})(i,r,e,t)),o.init?.(),iV(a).then(()=>{t3(a)&&(t.nativeDestinations.integrationsConfig.value=((e,t,i)=>{let r=t;if(k(e.integration?.getDataForIntegrationsObject))try{r={...t,...ey(e.integration.getDataForIntegrationsObject())}}catch(t){i?.onError({error:t,context:iH,customMessage:iz(e.userFriendlyId),groupingHash:iz(e.displayName),category:im})}return r})(a,t.nativeDestinations.integrationsConfig.value,n)),t.nativeDestinations.initializedDestinations.value=[...t.nativeDestinations.initializedDestinations.value,a]}).catch(i=>{t.nativeDestinations.failedDestinations.value=[...t.nativeDestinations.failedDestinations.value,e],n?.onError({error:i,context:iH,customMessage:iQ(e.userFriendlyId),groupingHash:iQ(e.displayName),category:im})})}catch(i){t.nativeDestinations.failedDestinations.value=[...t.nativeDestinations.failedDestinations.value,e],n?.onError({error:i,context:iH,customMessage:iF(e.userFriendlyId),groupingHash:iF(e.displayName),category:im})}},iW=e=>e.filter(e=>e.enabled),iJ=(e,t,i)=>{let r="boolean"==typeof t.enabled&&t.enabled!==e.enabled,n=R(t.config),s="boolean"==typeof t.enabled?t.enabled:e.enabled,a=n&&s;if(!r&&!a&&!i)return e;let o=v(e);return i&&(o.id=`${e.id}_${i}`,o.userFriendlyId=`${e.userFriendlyId}_${i}`),r&&(o.enabled=t.enabled,o.overridden=!0),a&&(o.config=$({...o.config,...t.config}),o.overridden=!0),o},iX="DeviceModeDestinations",iZ={minRetryDelay:500,backoffFactor:2,maxAttempts:3},iY="DeviceModeTransformationPlugin",i0=(e,t,i,r,n)=>`${e}:: Event transformation unsuccessful for destination "${t}" with id "${i}". Reason: ${r}. ${n}.`,i1=(e,t,i,r,n)=>`${e}:: [Destination: ${t} with id "${i}"].Transformation request failed with status: ${r}. Retries exhausted. ${n}.`,i2=(e,t,i)=>{t.includes(e)||(t.push(e),i())},i4="DeviceModeTransformation",i5={segment:"ajs_anonymous_id"},i6="ExternalAnonymousId",i3={getUserLanguage:()=>navigator?.language,getUserAgent:()=>navigator?.userAgent},i8=(e="")=>decodeURIComponent(globalThis.atob(e.endsWith("..")?e.substring(0,e.length-2):e).split("").map(e=>{let t=`00${e.charCodeAt(0).toString(16)}`;return`%${t.slice(-2)}`}).join("")),i9=/^[\w.-]+$/,i7=(e,t,i,r)=>(e=>{let t=(()=>{let e,t=[];for(let i=0;i<256;i++){e=i;for(let t=0;t<8;t++)e=1&e?0xedb88320^e>>>1:e>>>1;t[i]=e}return t})(),i=-1;for(let r=0;r<e.length;r++)i=i>>>8^t[(i^e.charCodeAt(r))&255];return(-1^i)>>>0})([[i,new Date().getTimezoneOffset(),r].join("*"),Math.floor(Date.now()/6e4)-(t||0),e].join("*")).toString(36),re="GoogleLinker",rt=e=>`${e}:: Failed to read the consent cookie.`,ri="IubendaConsentManagerPlugin",rr=/^_iub_cs-\d+$/,rn=(e,t)=>{let i=(e=>{let t=[],i=[];return e&&Object.entries(e).forEach(e=>{let r=e[0];e[1]?t.push(r):i.push(r)}),{allowedConsentIds:t,deniedConsentIds:i}})(t);e.consents.initialized.value=A(t),e.consents.data.value=i},rs="IubendaConsentManager",ra="KetchConsentManagerPlugin",ro=(e,t)=>{let i=(e=>{let t=[],i=[];return e&&Object.entries(e).forEach(e=>{let r=e[0];e[1]?t.push(r):i.push(r)}),{allowedConsentIds:t,deniedConsentIds:i}})(t);e.consents.initialized.value=A(t),e.consents.data.value=i},rl="KetchConsentManager",ru={maxItems:100},rc="NativeDestinationQueuePlugin",rd=(e,t,i)=>`Failed to send "${e}" event ${i?`"${i}" `:""}to integration for destination "${t}".`,rh=(e,t,i,r)=>{let n=e.type.toString();try{t.integration[n]?.({message:e})}catch(r){i?.onError({error:r,context:rc,customMessage:rd(n,t.userFriendlyId,e.event),groupingHash:rd(n,t.displayName,e.event),category:im})}},rg="NativeDestinationQueue",rp="OneTrustConsentManagerPlugin",rf="OneTrustConsentManager",rv="StorageEncryption",ry=("undefined"!=typeof globalThis?globalThis:void 0)?.crypto||("undefined"!=typeof global?global:void 0)?.crypto||("undefined"!=typeof window?window:void 0)?.crypto||("undefined"!=typeof self?self:void 0)?.crypto||("undefined"!=typeof frames?frames:void 0)?.[0]?.crypto;r=ry?e=>{let t=[];for(let i=0;i<e;i+=4)t.push(ry.getRandomValues(new Uint32Array(1))[0]);return new rb(t,e)}:e=>{let t=[],i=e=>{let t=e,i=0x3ade68b1;return()=>{let e=((i=36969*(65535&i)+(i>>16)|0)<<16)+(t=18e3*(65535&t)+(t>>16)|0)|0;return e/=0x100000000,(e+=.5)*(Math.random()>.5?1:-1)}};for(let r=0,n;r<e;r+=4){let e=i(0x100000000*(n||Math.random()));n=0x3ade67b7*e(),t.push(0x100000000*e()|0)}return new rb(t,e)};class rm{static create(...e){return new this(...e)}mixIn(e){return Object.assign(this,e)}clone(){let e=new this.constructor;return Object.assign(e,this),e}}class rb extends rm{constructor(e=[],t=4*e.length){super();let i=e;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(i instanceof Int8Array||i instanceof Uint8ClampedArray||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array)&&(i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),i instanceof Uint8Array){let e=i.byteLength,t=[];for(let r=0;r<e;r+=1)t[r>>>2]|=i[r]<<24-r%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random=r;toString(e=rE){return e.stringify(this)}concat(e){let t=this.words,i=e.words,r=this.sigBytes,n=e.sigBytes;if(this.clamp(),r%4)for(let e=0;e<n;e+=1){let n=i[e>>>2]>>>24-e%4*8&255;t[r+e>>>2]|=n<<24-(r+e)%4*8}else for(let e=0;e<n;e+=4)t[r+e>>>2]=i[e>>>2];return this.sigBytes+=n,this}clamp(){let{words:e,sigBytes:t}=this;e[t>>>2]&=0xffffffff<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){let e=super.clone.call(this);return e.words=this.words.slice(0),e}}let rE={stringify(e){let{words:t,sigBytes:i}=e,r=[];for(let e=0;e<i;e+=1){let i=t[e>>>2]>>>24-e%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse(e){let t=e.length,i=[];for(let r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new rb(i,t/2)}},rI={stringify(e){let{words:t,sigBytes:i}=e,r=[];for(let e=0;e<i;e+=1){let i=t[e>>>2]>>>24-e%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse(e){let t=e.length,i=[];for(let r=0;r<t;r+=1)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new rb(i,t)}},rk={stringify(e){try{return decodeURIComponent(escape(rI.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:e=>rI.parse(unescape(encodeURIComponent(e)))};class rS extends rm{constructor(){super(),this._minBufferSize=0}reset(){this._data=new rb,this._nDataBytes=0}_append(e){let t=e;"string"==typeof t&&(t=rk.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t,{_data:i,blockSize:r}=this,n=i.words,s=i.sigBytes,a=s/(4*r),o=(a=e?Math.ceil(a):Math.max((0|a)-this._minBufferSize,0))*r,l=Math.min(4*o,s);if(o){for(let e=0;e<o;e+=r)this._doProcessBlock(n,e);t=n.splice(0,o),i.sigBytes-=l}return new rb(t,l)}clone(){let e=super.clone.call(this);return e._data=this._data.clone(),e}}class rA extends rS{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new rm,e),this.reset()}static _createHelper(e){return(t,i)=>new e(i).finalize(t)}static _createHmacHelper(e){return(t,i)=>new rT(e,i).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){return e&&this._append(e),this._doFinalize()}}class rT extends rm{constructor(e,t){super();let i=new e;this._hasher=i;let r=t;"string"==typeof r&&(r=rk.parse(r));let n=i.blockSize,s=4*n;r.sigBytes>s&&(r=i.finalize(t)),r.clamp();let a=r.clone();this._oKey=a;let o=r.clone();this._iKey=o;let l=a.words,u=o.words;for(let e=0;e<n;e+=1)l[e]^=0x5c5c5c5c,u[e]^=0x36363636;a.sigBytes=s,o.sigBytes=s,this.reset()}reset(){let e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){let t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}}let rw={stringify(e){let{words:t,sigBytes:i}=e,r=this._map;e.clamp();let n=[];for(let e=0;e<i;e+=3){let s=t[e>>>2]>>>24-e%4*8&255,a=s<<16|(t[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|t[e+2>>>2]>>>24-(e+2)%4*8&255;for(let t=0;t<4&&e+.75*t<i;t+=1)n.push(r.charAt(a>>>6*(3-t)&63))}let s=r.charAt(64);if(s)for(;n.length%4;)n.push(s);return n.join("")},parse(e){let t=e.length,i=this._map,r=this._reverseMap;if(!r){this._reverseMap=[],r=this._reverseMap;for(let e=0;e<i.length;e+=1)r[i.charCodeAt(e)]=e}let n=i.charAt(64);if(n){let i=e.indexOf(n);-1!==i&&(t=i)}var s=e,a=t,o=r;let l=[],u=0;for(let e=0;e<a;e+=1)if(e%4){let t=o[s.charCodeAt(e-1)]<<e%4*2|o[s.charCodeAt(e)]>>>6-e%4*2;l[u>>>2]|=t<<24-u%4*8,u+=1}return rb.create(l,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},rC=[];for(let e=0;e<64;e+=1)rC[e]=0x100000000*Math.abs(Math.sin(e+1))|0;let rD=(e,t,i,r,n,s,a)=>{let o=e+(t&i|~t&r)+n+a;return(o<<s|o>>>32-s)+t},rP=(e,t,i,r,n,s,a)=>{let o=e+(t&r|i&~r)+n+a;return(o<<s|o>>>32-s)+t},rO=(e,t,i,r,n,s,a)=>{let o=e+(t^i^r)+n+a;return(o<<s|o>>>32-s)+t},rR=(e,t,i,r,n,s,a)=>{let o=e+(i^(t|~r))+n+a;return(o<<s|o>>>32-s)+t};class rx extends rA{_doReset(){this._hash=new rb([0x67452301,0xefcdab89,0x98badcfe,0x10325476])}_doProcessBlock(e,t){for(let i=0;i<16;i+=1){let r=t+i,n=e[r];e[r]=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00}let i=this._hash.words,r=e[t+0],n=e[t+1],s=e[t+2],a=e[t+3],o=e[t+4],l=e[t+5],u=e[t+6],c=e[t+7],d=e[t+8],h=e[t+9],g=e[t+10],p=e[t+11],f=e[t+12],v=e[t+13],y=e[t+14],m=e[t+15],b=i[0],E=i[1],I=i[2],k=i[3];b=rD(b,E,I,k,r,7,rC[0]),k=rD(k,b,E,I,n,12,rC[1]),I=rD(I,k,b,E,s,17,rC[2]),E=rD(E,I,k,b,a,22,rC[3]),b=rD(b,E,I,k,o,7,rC[4]),k=rD(k,b,E,I,l,12,rC[5]),I=rD(I,k,b,E,u,17,rC[6]),E=rD(E,I,k,b,c,22,rC[7]),b=rD(b,E,I,k,d,7,rC[8]),k=rD(k,b,E,I,h,12,rC[9]),I=rD(I,k,b,E,g,17,rC[10]),E=rD(E,I,k,b,p,22,rC[11]),b=rD(b,E,I,k,f,7,rC[12]),k=rD(k,b,E,I,v,12,rC[13]),I=rD(I,k,b,E,y,17,rC[14]),E=rD(E,I,k,b,m,22,rC[15]),b=rP(b,E,I,k,n,5,rC[16]),k=rP(k,b,E,I,u,9,rC[17]),I=rP(I,k,b,E,p,14,rC[18]),E=rP(E,I,k,b,r,20,rC[19]),b=rP(b,E,I,k,l,5,rC[20]),k=rP(k,b,E,I,g,9,rC[21]),I=rP(I,k,b,E,m,14,rC[22]),E=rP(E,I,k,b,o,20,rC[23]),b=rP(b,E,I,k,h,5,rC[24]),k=rP(k,b,E,I,y,9,rC[25]),I=rP(I,k,b,E,a,14,rC[26]),E=rP(E,I,k,b,d,20,rC[27]),b=rP(b,E,I,k,v,5,rC[28]),k=rP(k,b,E,I,s,9,rC[29]),I=rP(I,k,b,E,c,14,rC[30]),E=rP(E,I,k,b,f,20,rC[31]),b=rO(b,E,I,k,l,4,rC[32]),k=rO(k,b,E,I,d,11,rC[33]),I=rO(I,k,b,E,p,16,rC[34]),E=rO(E,I,k,b,y,23,rC[35]),b=rO(b,E,I,k,n,4,rC[36]),k=rO(k,b,E,I,o,11,rC[37]),I=rO(I,k,b,E,c,16,rC[38]),E=rO(E,I,k,b,g,23,rC[39]),b=rO(b,E,I,k,v,4,rC[40]),k=rO(k,b,E,I,r,11,rC[41]),I=rO(I,k,b,E,a,16,rC[42]),E=rO(E,I,k,b,u,23,rC[43]),b=rO(b,E,I,k,h,4,rC[44]),k=rO(k,b,E,I,f,11,rC[45]),I=rO(I,k,b,E,m,16,rC[46]),E=rO(E,I,k,b,s,23,rC[47]),b=rR(b,E,I,k,r,6,rC[48]),k=rR(k,b,E,I,c,10,rC[49]),I=rR(I,k,b,E,y,15,rC[50]),E=rR(E,I,k,b,l,21,rC[51]),b=rR(b,E,I,k,f,6,rC[52]),k=rR(k,b,E,I,a,10,rC[53]),I=rR(I,k,b,E,g,15,rC[54]),E=rR(E,I,k,b,n,21,rC[55]),b=rR(b,E,I,k,d,6,rC[56]),k=rR(k,b,E,I,m,10,rC[57]),I=rR(I,k,b,E,u,15,rC[58]),E=rR(E,I,k,b,v,21,rC[59]),b=rR(b,E,I,k,o,6,rC[60]),k=rR(k,b,E,I,p,10,rC[61]),I=rR(I,k,b,E,s,15,rC[62]),E=rR(E,I,k,b,h,21,rC[63]),i[0]=i[0]+b|0,i[1]=i[1]+E|0,i[2]=i[2]+I|0,i[3]=i[3]+k|0}_doFinalize(){let e=this._data,t=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;let n=Math.floor(i/0x100000000);t[(r+64>>>9<<4)+15]=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00,t[(r+64>>>9<<4)+14]=(i<<8|i>>>24)&0xff00ff|(i<<24|i>>>8)&0xff00ff00,e.sigBytes=(t.length+1)*4,this._process();let s=this._hash,a=s.words;for(let e=0;e<4;e+=1){let t=a[e];a[e]=(t<<8|t>>>24)&0xff00ff|(t<<24|t>>>8)&0xff00ff00}return s}clone(){let e=super.clone.call(this);return e._hash=this._hash.clone(),e}}class r$ extends rm{constructor(e){super(),this.cfg=Object.assign(new rm,{keySize:4,hasher:rx,iterations:1},e)}compute(e,t){let i,{cfg:r}=this,n=r.hasher.create(),s=rb.create(),a=s.words,{keySize:o,iterations:l}=r;for(;a.length<o;){i&&n.update(i),i=n.update(e).finalize(t),n.reset();for(let e=1;e<l;e+=1)i=n.finalize(i),n.reset();s.concat(i)}return s.sigBytes=4*o,s}}let rM="function"!=typeof Object.assign?function(e){if(null==e)throw TypeError("Cannot convert undefined or null to object");e=Object(e);for(let t=1;t<arguments.length;t++){let i=arguments[t];if(null!=i)for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e}:Object.assign;class rN extends rS{constructor(e,t,i){super(),this.cfg=rM(new rm,i),this._xformMode=e,this._key=t,this.reset()}static createEncryptor(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}static createDecryptor(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}static _createHelper(e){let t=e=>"string"==typeof e?rz:rF;return{encrypt:(i,r,n)=>t(r).encrypt(e,i,r,n),decrypt:(i,r,n)=>t(r).decrypt(e,i,r,n)}}reset(){super.reset.call(this),this._doReset()}process(e){return this._append(e),this._process()}finalize(e){return e&&this._append(e),this._doFinalize()}}rN._ENC_XFORM_MODE=1,rN._DEC_XFORM_MODE=2,rN.keySize=4,rN.ivSize=4;class r_ extends rm{constructor(e,t){super(),this._cipher=e,this._iv=t}static createEncryptor(e,t){return this.Encryptor.create(e,t)}static createDecryptor(e,t){return this.Decryptor.create(e,t)}}function rB(e,t,i){let r,n=this._iv;n?(r=n,this._iv=void 0):r=this._prevBlock;for(let n=0;n<i;n+=1)e[t+n]^=r[n]}class rL extends r_{}rL.Encryptor=class extends rL{processBlock(e,t){let i=this._cipher,{blockSize:r}=i;rB.call(this,e,t,r),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}},rL.Decryptor=class extends rL{processBlock(e,t){let i=this._cipher,{blockSize:r}=i,n=e.slice(t,t+r);i.decryptBlock(e,t),rB.call(this,e,t,r),this._prevBlock=n}};let rU={pad(e,t){let i=4*t,r=i-e.sigBytes%i,n=r<<24|r<<16|r<<8|r,s=[];for(let e=0;e<r;e+=4)s.push(n);let a=rb.create(s,r);e.concat(a)},unpad(e){let t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};class rj extends rN{constructor(e,t,i){super(e,t,rM({mode:rL,padding:rU},i)),this.blockSize=4}reset(){let e;super.reset.call(this);let{cfg:t}=this,{iv:i,mode:r}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode=e.call(r,this,i&&i.words),this._mode.__creator=e}_doProcessBlock(e,t){this._mode.processBlock(e,t)}_doFinalize(){let e,{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}class rH extends rm{constructor(e){super(),this.mixIn(e)}toString(e){return(e||this.formatter).stringify(this)}}class rF extends rm{static encrypt(e,t,i,r){let n=rM(new rm,this.cfg,r),s=e.createEncryptor(i,n),a=s.finalize(t),o=s.cfg;return rH.create({ciphertext:a,key:i,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:s.blockSize,formatter:n.format})}static decrypt(e,t,i,r){let n=t,s=rM(new rm,this.cfg,r);return n=this._parse(n,s.format),e.createDecryptor(i,s).finalize(n.ciphertext)}static _parse(e,t){return"string"==typeof e?t.parse(e,this):e}}rF.cfg=rM(new rm,{format:{stringify(e){let{ciphertext:t,salt:i}=e;return(i?rb.create([0x53616c74,0x65645f5f]).concat(i).concat(t):t).toString(rw)},parse(e){let t,i=rw.parse(e),r=i.words;return 0x53616c74===r[0]&&0x65645f5f===r[1]&&(t=rb.create(r.slice(2,4)),r.splice(0,4),i.sigBytes-=16),rH.create({ciphertext:i,salt:t})}}});class rz extends rF{static encrypt(e,t,i,r){let n=rM(new rm,this.cfg,r),s=n.kdf.execute(i,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=s.iv;let a=rF.encrypt.call(this,e,t,s.key,n);return a.mixIn(s),a}static decrypt(e,t,i,r){let n=t,s=rM(new rm,this.cfg,r);n=this._parse(n,s.format);let a=s.kdf.execute(i,e.keySize,e.ivSize,n.salt,s.hasher);return s.iv=a.iv,rF.decrypt.call(this,e,n,a.key,s)}}rz.cfg=rM(rF.cfg,{kdf:{execute(e,t,i,r,n){let s,a=r;a||(a=rb.random(8)),s=n?r$.create({keySize:t+i,hasher:n}).compute(e,a):r$.create({keySize:t+i}).compute(e,a);let o=rb.create(s.words.slice(t),4*i);return s.sigBytes=4*t,rH.create({key:s,iv:o,salt:a})}}});let rQ=[],rG=[],rK=[],rV=[],rq=[],rW=[],rJ=[],rX=[],rZ=[],rY=[],r0=[];for(let e=0;e<256;e+=1)e<128?r0[e]=e<<1:r0[e]=e<<1^283;let r1=0,r2=0;for(let e=0;e<256;e+=1){let e=r2^r2<<1^r2<<2^r2<<3^r2<<4;e=e>>>8^255&e^99,rQ[r1]=e,rG[e]=r1;let t=r0[r1],i=r0[t],r=r0[i],n=257*r0[e]^0x1010100*e;rK[r1]=n<<24|n>>>8,rV[r1]=n<<16|n>>>16,rq[r1]=n<<8|n>>>24,rW[r1]=n,n=0x1010101*r^65537*i^257*t^0x1010100*r1,rJ[e]=n<<24|n>>>8,rX[e]=n<<16|n>>>16,rZ[e]=n<<8|n>>>24,rY[e]=n,r1?(r1=t^r0[r0[r0[r^t]]],r2^=r0[r0[r2]]):r1=r2=1}let r4=[0,1,2,4,8,16,32,64,128,27,54];class r5 extends rj{_doReset(){let e;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;let t=this._keyPriorReset,i=t.words,r=t.sigBytes/4;this._nRounds=r+6;let n=(this._nRounds+1)*4;this._keySchedule=[];let s=this._keySchedule;for(let t=0;t<n;t+=1)t<r?s[t]=i[t]:(e=s[t-1],t%r?r>6&&t%r==4&&(e=rQ[e>>>24]<<24|rQ[e>>>16&255]<<16|rQ[e>>>8&255]<<8|rQ[255&e]):e=(rQ[(e=e<<8|e>>>24)>>>24]<<24|rQ[e>>>16&255]<<16|rQ[e>>>8&255]<<8|rQ[255&e])^r4[t/r|0]<<24,s[t]=s[t-r]^e);this._invKeySchedule=[];let a=this._invKeySchedule;for(let t=0;t<n;t+=1){let i=n-t;e=t%4?s[i]:s[i-4],t<4||i<=4?a[t]=e:a[t]=rJ[rQ[e>>>24]]^rX[rQ[e>>>16&255]]^rZ[rQ[e>>>8&255]]^rY[rQ[255&e]]}}encryptBlock(e,t){this._doCryptBlock(e,t,this._keySchedule,rK,rV,rq,rW,rQ)}decryptBlock(e,t){let i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,rJ,rX,rZ,rY,rG),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i}_doCryptBlock(e,t,i,r,n,s,a,o){let l=this._nRounds,u=e[t]^i[0],c=e[t+1]^i[1],d=e[t+2]^i[2],h=e[t+3]^i[3],g=4;for(let e=1;e<l;e+=1){let e=r[u>>>24]^n[c>>>16&255]^s[d>>>8&255]^a[255&h]^i[g];g+=1;let t=r[c>>>24]^n[d>>>16&255]^s[h>>>8&255]^a[255&u]^i[g];g+=1;let o=r[d>>>24]^n[h>>>16&255]^s[u>>>8&255]^a[255&c]^i[g];g+=1;let l=r[h>>>24]^n[u>>>16&255]^s[c>>>8&255]^a[255&d]^i[g];g+=1,u=e,c=t,d=o,h=l}let p=(o[u>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&h])^i[g];g+=1;let f=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[h>>>8&255]<<8|o[255&u])^i[g];g+=1;let v=(o[d>>>24]<<24|o[h>>>16&255]<<16|o[u>>>8&255]<<8|o[255&c])^i[g];g+=1;let y=(o[h>>>24]<<24|o[u>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^i[g];g+=1,e[t]=p,e[t+1]=f,e[t+2]=v,e[t+3]=y}}r5.keySize=8;let r6=rj._createHelper(r5),r3="RudderEncrypt:",r8="Rudder",r9=e=>e.startsWith(r3)?r6.decrypt(e.substring(r3.length),r8).toString(rk):e,r7="StorageEncryptionLegacy",ne="StorageMigrator",nt={maxRetryDelay:36e4,minRetryDelay:1e3,backoffFactor:2,maxAttempts:10,maxItems:100},ni=(e,t,i)=>ef({batch:e,sentAt:t},!0,void 0,i),nr=(e,t)=>{let i=new URL(e);return new URL(ia(i.pathname+"/v1/"+t),i).href},nn="XhrQueue",ns=()=>({}),na={...ns(),BeaconQueue:()=>({name:iU,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,iU]},dataplaneEventsQueue:{init(e,t,i,r,n){let s=e.lifecycle.writeKey.value,a=((e,t)=>{let i=new URL(e);return new URL(ia(i.pathname+"/beacon/v1/"+`batch?writeKey=${t}`),i).href})(e.lifecycle.activeDataplaneUrl.value,s),o=O(iw,e.loadOptions.value.beaconQueueOptions??{});return new iL(`rudder_beacon_${s}`,{batch:{enabled:!0,flushInterval:o.flushQueueInterval,maxSize:65536,maxItems:o.maxItems}},(e,t,i)=>{let{isPageAccessible:s}=i;n?.debug(`${iC}:: Sending events to data plane.`);let o=eh(),l=iD(e.map(e=>ik(e.event,o)),o,n);if(!l)return void t(null);try{navigator.sendBeacon(a,l)?t(null):s?(n?.error(`${iA(iC,a)} The event(s) will be dropped.`),t(null)):n?.warn(`${iA(iC,a)} The event(s) will be retried as the current page is being unloaded.`)}catch(e){r?.onError({error:e,context:iC,customMessage:iT(a)}),t(null)}},i,it,n,e=>{let t=eh();return iD(e.map(e=>e.event),t,n).size})},enqueue(e,t,i,r,n){i.sentAt=eh(),iI(i,n),t.addItem({event:i})}}}),CustomConsentManager:()=>({name:ij,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,ij]},consentManager:{init(e,t){},updateConsentsInfo(e,t,i){},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{consentManagement:i}=t;if(!i)return!0;let r=i.find(t=>t.provider===e.consents.provider.value);if(!r?.consents)return!0;let s=r.consents.map(e=>e.consent.trim()).filter(e=>e),a=r.resolutionStrategy??e.consents.resolutionStrategy.value,o=e=>n.includes(e);if("or"===a)return s.some(o)||0===s.length;return s.every(o)}catch(e){return i?.onError({error:e,context:"CustomConsentManagerPlugin",customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),DeviceModeDestinations:()=>({name:iX,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,iX]},nativeDestinations:{addCustomIntegration(e,t,i,r){let n=((e,t,i,r)=>{let n,s=i.nativeDestinations.configuredDestinations.value.find(t=>t.id===e&&!0===t.isCustomIntegration);if(!s)return void r.error(`${iH}:: The destination ID "${e}" does not correspond to a custom device mode destination.`);if(A(s.integration))return void r.error(`${iH}:: A custom integration with destination ID "${e}" was already added.`);if(null==(n=t)||!k(t.isReady)||A(t.init)&&!k(t.init)||A(t.track)&&!k(t.track)||A(t.page)&&!k(t.page)||A(t.identify)&&!k(t.identify)||A(t.group)&&!k(t.group)||A(t.alias)&&!k(t.alias))return void r.error(`${iH}:: The custom integration added for destination ID "${e}" does not match the expected implementation format.`);return s})(e,t,i,r);if(n){let e=i.lifecycle.safeAnalyticsInstance.value,s=v(r);s.setScope(n.displayName);let a={log:s.log.bind(s),info:s.info.bind(s),debug:s.debug.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),setMinLogLevel:s.setMinLogLevel.bind(s)},o=v(n.config);n.integration={...t.init&&{init:()=>t.init(o,e,a)},...t.track&&{track:i=>t.track(e,a,i)},...t.page&&{page:i=>t.page(e,a,i)},...t.identify&&{identify:i=>t.identify(e,a,i)},...t.group&&{group:i=>t.group(e,a,i)},...t.alias&&{alias:i=>t.alias(e,a,i)},isReady:()=>t.isReady(e,a)},i.nativeDestinations.configuredDestinations.value=[...i.nativeDestinations.configuredDestinations.value]}},setActiveDestinations(e,t,i,r){e.nativeDestinations.loadIntegration.value=e.loadOptions.value.loadIntegration;let n=e.nativeDestinations.configuredDestinations.value.filter(e=>{let t;if(e.isCustomIntegration&&void 0===e.integration){let t;return e.enabled&&r?.warn((t=e.id,`${iH}:: No valid custom integration was added for destination ID "${t}". Ignoring it.`)),!1}if(e.isCustomIntegration||iK[e.displayName])return!0;let n=(t=e.displayName,`Integration for destination "${t}" is not supported.`);return i?.onError({error:Error(n),context:iH,category:im}),!1}),s=e.loadOptions.value.sourceConfigurationOverride?((e,t,i)=>{if(!t?.destinations?.length)return iW(e);let r=e.map(e=>e.id),n={};t.destinations.forEach(e=>{let t=n[e.id]||[];t.push(e),n[e.id]=t});let s=Object.keys(n).filter(e=>!r.includes(e));s.length>0&&i?.warn(`${iH}:: Source configuration override - Unable to identify the destinations with the following IDs: "${s.join(", ")}"`);let a=[];return e.forEach(e=>{let t=n[e.id];if(!t||0===t.length)return void a.push(e);if(t.length>1)t.forEach((t,i)=>{let r=iJ(e,t,`${i+1}`);r.cloned=!0,r.originalId=e.id,a.push(r)});else{let i=iJ(e,t[0]);a.push(i)}}),iW(a)})(n,e.loadOptions.value.sourceConfigurationOverride,r):iW(n),a=iG(e.consents.postConsent.value?.integrations??e.nativeDestinations.loadOnlyIntegrations.value,s).filter(n=>t.invokeSingle("consentManager.isDestinationConsented",e,n.config,i,r)??!0);e.nativeDestinations.activeDestinations.value=[...e.nativeDestinations.activeDestinations.value,...a]},load(e,t,i,r,n){let s=e.lifecycle.integrationsCDNPath.value;e.nativeDestinations.activeDestinations.value.forEach(r=>{let a=iK[r.displayName],o=`${a}_RS`;if(a&&(!globalThis[o]?.[a]?.prototype||void 0===globalThis[o][a].prototype.constructor)){let l=`${s}/${a}.min.js`;t.loadJSFile({url:l,id:r.userFriendlyId,callback:n??((t,n)=>{if(n){let t,s=(t=r.displayName,`Failed to load integration SDK for destination "${t}"`);i?.onError({error:n,context:iH,customMessage:s,groupingHash:s,category:im}),e.nativeDestinations.failedDestinations.value=[...e.nativeDestinations.failedDestinations.value,r]}else iq(r,e,o,a,i)}),timeout:1e4})}else iq(r,e,o,a,i)})}}}),DeviceModeTransformation:()=>({name:i4,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,i4]},transformEvent:{init(e,t,i,r,n,s){let a=e.lifecycle.writeKey.value;return i.setAuthHeader(a),new iL(`rudder_${a}`,iZ,(r,a,o)=>{var l,u;let c,d=(l=r.event,u=r.destinationIds,{metadata:{"Custom-Authorization":r.token},batch:[{orderNo:Date.now(),destinationIds:u,event:l}]});i.getAsyncData({url:`${e.lifecycle.activeDataplaneUrl.value}/transform`,options:{method:"POST",data:ef(d,!0,void 0,c),sendRawData:!0},isRawResponse:!0,timeout:1e4,callback:(i,l)=>{let u=il(l?.xhr?.status??0);void 0!==l?.error&&u&&o.retryAttemptNumber!==o.maxRetryAttempts?a(l):(((e,t,i,r,n,s,a,o)=>{let l="Sending untransformed event",u="Dropping the event",c=e.nativeDestinations.initializedDestinations.value.filter(e=>{let t;return e&&i.includes((t=e).originalId??t.id)}),d=[];c.forEach(i=>{try{let c,h=[],g=(c=i).originalId??c.id;switch(n){case 200:{let e=JSON.parse(r).transformedBatch.find(e=>e.id===g);e?.payload.forEach(e=>{if("200"===e.status)h.push(e.event);else{let t="Unknown";"410"===e.status&&(t="Transformation is not available");let r=u;!0===i.propagateEventsUntransformedOnError?(r=l,h.push(s),i2(g,d,()=>{o?.warn(i0(iY,i.displayName,g,t,r))})):i2(g,d,()=>{o?.error(i0(iY,i.displayName,g,t,r))})}});break}case 404:i2(g,d,()=>{o?.warn(`${iY}:: Transformation server access is denied. The configuration data seems to be out of sync. Sending untransformed event to the destination.`)}),h.push(s);break;default:!0===i.propagateEventsUntransformedOnError?(i2(g,d,()=>{o?.warn(i1(iY,i.displayName,g,n,l))}),h.push(s)):i2(g,d,()=>{o?.error(i1(iY,i.displayName,g,n,u))})}h?.forEach(r=>{R(r)&&t.invokeSingle("destinationsEventsQueue.enqueueEventToDestination",e,r,i,a,o)})}catch(r){let e,t;a?.onError({error:r,context:iY,customMessage:(e=i.displayName,t=i.id,`Transformation failed for destination "${e}" with id "${t}"`)})}})})(e,t,r.destinationIds,i,l?.xhr?.status,r.event,n,s),a(null))}})},r,ir)},enqueue(e,t,i,r){let n=[];r.forEach(e=>{let t=e.originalId??e.id;n.includes(t)||n.push(t)}),t.addItem({event:i,destinationIds:n,token:e.session.authToken.value})}}}),ExternalAnonymousId:()=>({name:i6,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,i6]},storage:{getAnonymousId(e,t){let i;if(t?.autoCapture?.enabled&&t.autoCapture.source){let r=t.autoCapture.source.toLowerCase();if(!Object.keys(i5).includes(r))return i;"segment"===r&&(i=(e=>{let t,i=e(it);i?.isEnabled&&(t=i.getItem(i5.segment));let r=e(ie);return!t&&r?.isEnabled&&(t=r.getItem(i5.segment)),t})(e))}return i}}}),GoogleLinker:()=>({name:re,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,re]},userSession:{anonymousIdGoogleLinker(e){if(!e)return null;let t=e?(e=>{let t=(e=>{let t=e.split("*"),i=t.length%2==0;return t.length<4||!i||1!==Number(t.shift())?null:{checksum:t.shift()??"",serializedIds:t.join("*")}})(e);if(!t)return null;let{checksum:i,serializedIds:r}=t;return r&&i&&((e,t)=>{let i=i3.getUserAgent(),r=i3.getUserLanguage();for(let n=0;n<=1;n+=1)if(i7(e,n,i,r)===t)return!0;return!1})(r,i)?(e=>{if(!e)return{};let t={},i=e.split("*");for(let e=0;e<i.length;e+=2){let r=i[e];i9.test(r)&&(t[r]=i8(i[e+1]))}return t})(r):null})(e):null;return t?t.rs_amp_id:null}}}),IubendaConsentManager:()=>({name:rs,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rs]},consentManager:{init(e,t){globalThis.getIubendaUserConsentedPurposes=()=>e.consents.data.value.allowedConsentIds?.slice(),globalThis.getIubendaUserDeniedPurposes=()=>e.consents.data.value.deniedConsentIds?.slice(),globalThis.updateIubendaConsent=t=>{rn(e,t)}},updateConsentsInfo(e,t,i){let r;rn(e,r=void 0===globalThis._iub.cs.consent.purposes?((e,t)=>{let i,r,n=null;try{let i=e?.setStore({id:ri,name:ri,type:ie,errorHandler:e?.errorHandler,logger:e?.logger});n=i?.engine.getItem((e=>{try{let e=document.cookie.split("; ").find(e=>{let[t]=e.split("=");return rr.test((t||"").trim())});if(!e)throw Error("Iubenda Cookie not found with the specified pattern.");let[t]=e.split("=");return t||""}catch(t){return e?.error(rt(ri),t),""}})(t))}catch(e){t?.error(rt(ri),e);return}if(null!=(i=n)){try{r=JSON.parse(decodeURIComponent(n))}catch(e){t?.error(`${ri}:: Failed to parse the consent cookie.`,e);return}if(r)return r.purposes}})(t,i):globalThis._iub.cs.consent.purposes)},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds,s=e=>n.includes(e);try{let{consentManagement:i}=t;if(i){let t=i.find(t=>t.provider===e.consents.provider.value);if(!t?.consents)return!0;let r=t.consents.map(e=>e.consent.trim()).filter(e=>e);if((t.resolutionStrategy??e.consents.resolutionStrategy.value)==="or")return r.some(s)||0===r.length;return r.every(s)}return!0}catch(e){return i?.onError({error:e,context:ri,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),KetchConsentManager:()=>({name:rl,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rl]},consentManager:{init(e,t){globalThis.getKetchUserConsentedPurposes=()=>e.consents.data.value.allowedConsentIds?.slice(),globalThis.getKetchUserDeniedPurposes=()=>e.consents.data.value.deniedConsentIds?.slice(),globalThis.updateKetchConsent=t=>{ro(e,t)}},updateConsentsInfo(e,t,i){let r;ro(e,r=void 0===globalThis.ketchConsent?((e,t)=>{let i,r,n=null;try{let t=e?.setStore({id:ra,name:ra,type:ie,errorHandler:e?.errorHandler,logger:e?.logger});n=t?.engine.getItem("_ketch_consent_v1_")}catch(e){t?.error(`${ra}:: Failed to read the consent cookie.`,e);return}if(null==(i=n))return;try{r=JSON.parse(j(n))}catch(e){t?.error(`${ra}:: Failed to parse the consent cookie.`,e);return}if(!r)return;let s={};return Object.entries(r).forEach(e=>{let t=e[0],i=e[1];s[t]=i?.status==="granted"}),s})(t,i):globalThis.ketchConsent)},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{ketchConsentPurposes:i,consentManagement:r}=t,s=e=>n.includes(e);if(r){let t=r.find(t=>t.provider===e.consents.provider.value)?.consents;if(!t)return!0;let i=t.map(e=>e.consent.trim()).filter(e=>e);if("or"===e.consents.resolutionStrategy.value)return i.some(s)||0===i.length;return i.every(s)}if(i){let e=i.map(e=>e.purpose.trim()).filter(e=>e);return e.some(s)||0===e.length}return!0}catch(e){return i?.onError({error:e,context:ra,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),NativeDestinationQueue:()=>({name:rg,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rg]},destinationsEventsQueue:{init(e,t,i,r,n,s){let a=O(ru,e.loadOptions.value.destinationsQueueOptions),o=e.lifecycle.writeKey.value;return new iL(`rudder_destinations_events_${o}`,a,(i,a)=>{let o=iG(i.integrations,e.nativeDestinations.initializedDestinations.value),l=[],u=v(i);o.forEach(e=>{try{if(((e,t,i)=>{if("track"!==e)return!1;let{blacklistedEvents:r,whitelistedEvents:n,eventFilteringOption:s}=i.config;switch(s){case"blacklistedEvents":{let e;if(!((e=t)&&"string"==typeof e))return!1;let i=t.trim();if(Array.isArray(r))return r.some(e=>e.eventName.trim()===i);return!1}case"whitelistedEvents":{let e;if(!((e=t)&&"string"==typeof e))return!0;let i=t.trim();if(Array.isArray(n))return!n.some(e=>e.eventName.trim()===i);return!0}default:return!1}})(u.type,u.event,e)){let t,i;return void s?.warn((t=u.event,i=e.userFriendlyId,`${rc}:: The "${t}" track event has been filtered for the "${i}" destination.`))}e.shouldApplyDeviceModeTransformation?l.push(e):rh(u,e,n,s)}catch(e){n?.onError({error:e,context:rc,category:im})}}),l.length>0&&t.invokeSingle("transformEvent.enqueue",e,r,u,l,n,s),a(null)},i,ir)},enqueue(e,t,i,r,n){t.addItem(i)},enqueueEventToDestination(e,t,i,r,n){rh(t,i,r)}}}),OneTrustConsentManager:()=>({name:rf,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rf]},consentManager:{init(e,t){},updateConsentsInfo(e,t,i){if(!globalThis.OneTrust||!globalThis.OnetrustActiveGroups){i?.error(`${rp}:: Failed to access OneTrust SDK resources. Please ensure that the OneTrust SDK is loaded successfully before RudderStack SDK.`),e.consents.initialized.value=!1;return}let r=globalThis.OneTrust.GetDomainData().Groups,n=globalThis.OnetrustActiveGroups.split(",").filter(e=>e),s=[];r.forEach(({CustomGroupId:e})=>{n.includes(e)||s.push(e)}),e.consents.initialized.value=!0,e.consents.data.value={allowedConsentIds:n,deniedConsentIds:s}},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{oneTrustCookieCategories:i,consentManagement:r}=t,s=e=>n.includes(e);if(r){let t=r.find(t=>t.provider===e.consents.provider.value)?.consents;if(!t)return!0;let i=t.map(e=>e.consent.trim()).filter(e=>e);if("or"===e.consents.resolutionStrategy.value)return i.some(s)||0===i.length;return i.every(s)}if(i)return i.map(e=>e.oneTrustCookieCategory.trim()).filter(e=>e).every(s);return!0}catch(e){return i?.onError({error:e,context:rp,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),StorageEncryption:()=>({name:rv,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rv]},storage:{encrypt:e=>`${ip}${U(e)}`,decrypt:e=>iv(e)}}),StorageEncryptionLegacy:()=>({name:r7,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,r7]},storage:{encrypt:e=>`${r3}${r6.encrypt(e,r8).toString()}`,decrypt:e=>r9(e)}}),StorageMigrator:()=>({name:ne,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,ne]},storage:{migrate(e,t,i,r){try{let i,r=t.getItem(e);if(null==(i=r))return null;let n=r,s=r9(n);for(s=iv(s),n=JSON.parse(s);S(n)&&(s=r9(n),(s=iv(s))!==n);)n=JSON.parse(s);return n}catch(r){let t=`Failed to retrieve or parse data for "${e}" from storage.`;return i?.onError({error:r,context:"StorageMigratorPlugin",customMessage:t,groupingHash:t}),null}}}}),XhrQueue:()=>({name:nn,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,nn]},dataplaneEventsQueue:{init(e,t,i,r,n){let s=e.lifecycle.writeKey.value;return t.setAuthHeader(s),new iL(`rudder_${s}`,O(nt,e.loadOptions.value.queueOptions),(i,r,s)=>{let{data:a,url:o,headers:l}=((e,t,i,r)=>{let n,s,a,o=eh();if(Array.isArray(e))n=ni(e.map(e=>ik(e.event,o)),o,r),s=e[0]?v(e[0].headers):{},a=nr(t.lifecycle.activeDataplaneUrl.value,"batch");else{let{url:t,event:i,headers:l}=e;n=iE(ik(i,o),r),s=v(l),a=t}return s.SentAt=o,i.reclaimed&&(s["Rsa-Recovered"]="true"),i.retryAttemptNumber>0&&(s["Rsa-Retry-Attempt"]=i.retryAttemptNumber.toString(),s["Rsa-Since-Last-Attempt"]=i.timeSinceLastAttempt.toString(),s["Rsa-Since-First-Attempt"]=i.timeSinceFirstAttempt.toString(),s["Rsa-Retry-Reason"]=i.retryReason),{data:n,headers:s,url:a}})(i,e,s,n);t.getAsyncData({url:o,options:{method:"POST",headers:l,data:a,sendRawData:!0},isRawResponse:!0,timeout:3e4,callback:(e,t)=>{if(void 0===t?.error)return void r(null);let i=il(t?.xhr?.status??0);if(((e,t,i,r)=>{let n;if(!r)return;let s=(n=e?.error?.message??"Unknown",`XhrQueuePlugin:: Failed to deliver event(s). Cause: ${n}.`),a="The event(s) will be dropped.";t?i.willBeRetried?(s=`${s} The event(s) will be retried.`,i.retryAttemptNumber>0&&(s=`${s} Retry attempt ${i.retryAttemptNumber} of ${i.maxRetryAttempts}.`),r.warn(s)):r.error(`${s} Retries exhausted (${i.maxRetryAttempts}). ${a}`):r.error(`${s} ${a}`)})(t,i,s,n),i){let e=iy;t?.timedOut?e="client-timeout":A(t?.xhr?.status)&&(e=`server-${t.xhr.status}`),r(t,{retryReason:e})}else r(null)}})},i,e.capabilities.storage.isLocalStorageAvailable.value?it:ir,n,e=>{let t=eh(),i=e.map(e=>e.event);return ni(i,t,n)?.length})},enqueue(e,t,i,r,n){i.sentAt=eh(),iI(i,n);let s=nr(e.lifecycle.activeDataplaneUrl.value,i.type),a={AnonymousId:U(i.anonymousId)};t.addItem({url:s,headers:a,event:i})}}})};class no{constructor(e,t,i){this.engine=e,this.errorHandler=t,this.logger=i,this.onError=this.onError.bind(this)}init(){tM.lifecycle.status.value="pluginsLoading",this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){e2(()=>{(0===tM.plugins.activePlugins.value.length||tM.plugins.loadedPlugins.value.length+tM.plugins.failedPlugins.value.length===tM.plugins.totalPluginsToLoad.value)&&eL(()=>{tM.plugins.ready.value=!0,tM.lifecycle.status.value="pluginsReady"})})}getPluginsToLoadBasedOnConfig(){let e=tM.plugins.pluginsToLoadFromConfig.value;return e?(e=e.filter(e=>{if(t7.includes(e))return this.logger.warn(`${J}:: ${e} plugin is deprecated. Please exclude it from the load API options.`),!1;return!0}),[{configurationStatus:()=>A(tM.dataPlaneEvents.eventsQueuePluginName.value),configurationStatusStr:"Data plane events delivery is enabled",activePluginName:tM.dataPlaneEvents.eventsQueuePluginName.value,supportedPlugins:Object.values(tv),shouldAddMissingPlugins:!0},{configurationStatus:()=>t8(tM.nativeDestinations.configuredDestinations.value).length>0,configurationStatusStr:"Device mode destinations are connected to the source",supportedPlugins:["DeviceModeDestinations","NativeDestinationQueue"]},{configurationStatus:()=>t8(tM.nativeDestinations.configuredDestinations.value).some(e=>e.shouldApplyDeviceModeTransformation),configurationStatusStr:"Device mode transformations are enabled for at least one destination",supportedPlugins:["DeviceModeTransformation"]},{configurationStatus:()=>A(tM.consents.activeConsentManagerPluginName.value),configurationStatusStr:"Consent management is enabled",activePluginName:tM.consents.activeConsentManagerPluginName.value,supportedPlugins:Object.values(tp)},{configurationStatus:()=>A(tM.storage.encryptionPluginName.value),configurationStatusStr:"Storage encryption is enabled",activePluginName:tM.storage.encryptionPluginName.value,supportedPlugins:Object.values(tf)},{configurationStatus:()=>tM.storage.migrate.value,configurationStatusStr:"Storage migration is enabled",supportedPlugins:["StorageMigrator"]}].forEach(t=>{t.configurationStatus()?(e=e.filter(t.activePluginName?e=>!(e!==t.activePluginName&&t.supportedPlugins.includes(e)):e=>A(e)),this.addMissingPlugins(t,!1,e)):e=e.filter(void 0!==t.basePlugins?e=>!(t.basePlugins.includes(e)||t.supportedPlugins.includes(e)):e=>!t.supportedPlugins.includes(e))}),[...Object.keys(ns()),...e]):[]}addMissingPlugins(e,t,i){let r=e.shouldAddMissingPlugins||t,n=(e.activePluginName?[...e.basePlugins||[],e.activePluginName]:[...e.supportedPlugins]).filter(e=>!i.includes(e));n.length>0&&(r&&i.push(...n),this.logger.warn(((e,t,i,r)=>{let n=1===i.length,s=n?` '${i[0]}' plugin was`:` ['${i.join("', '")}'] plugins were`,a=`${e}:: ${t}, but${s} not configured to load.`;return r?`${a} So, ${n?"the plugin":"those plugins"} will be loaded automatically.`:`${a} Ignore if this was intentional. Otherwise, consider adding ${n?"it":"them"} to the 'plugins' load API option.`})(J,e.configurationStatusStr,n,r)))}setActivePlugins(){let e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(na),...t9],i=[],r=[];e.forEach(e=>{t.includes(e)?i.push(e):r.push(e)}),r.length>0&&this.logger.warn(`${J}:: Ignoring unknown plugins: ${r.join(", ")}.`),eL(()=>{tM.plugins.totalPluginsToLoad.value=e.length,tM.plugins.activePlugins.value=i,tM.plugins.failedPlugins.value=r})}registerLocalPlugins(){Object.values(na).forEach(e=>{k(e)&&tM.plugins.activePlugins.value.includes(e().name)&&this.register([e()])})}registerRemotePlugins(){let e=(tM.plugins.activePlugins.value,{});Promise.all(Object.keys(e).map(async t=>{await e[t]().then(e=>this.register([e.default()])).catch(e=>{tM.plugins.failedPlugins.value=[...tM.plugins.failedPlugins.value,t],this.onError(e,`Failed to load plugin "${t}"`,e)})})).catch(e=>{this.onError(e)})}invokeMultiple(e,...t){try{return this.engine.invokeMultiple(e,...t)}catch(t){return this.onError(t,e),[]}}invokeSingle(e,...t){try{return this.engine.invokeSingle(e,...t)}catch(t){return this.onError(t,e),null}}register(e){e.forEach(e=>{try{this.engine.register(e,tM)}catch(t){tM.plugins.failedPlugins.value=[...tM.plugins.failedPlugins.value,e.name],this.onError(t,`Failed to register plugin "${e.name}"`)}})}unregisterLocalPlugins(){Object.values(na).forEach(e=>{try{this.engine.unregister(e().name)}catch(t){this.onError(t,`Failed to unregister plugin "${e().name}"`)}})}onError(e,t,i){this.errorHandler.onError({error:e,context:J,customMessage:t,groupingHash:i})}}let nl="clientDataInCookie",nu="clientDataInLocalStorage",nc="clientDataInSessionStorage",nd=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],nh={[ie]:nl,[it]:nu,[ir]:"clientDataInMemory",[ii]:nc};class ng{isEnabled=!0;length=0;data={};constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isEnabled=!!this.options.enabled,this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return this.keys()[e]??null}keys(){return Object.keys(this.data)}}let np=new ng(e8);var nf={exports:{}};nf.exports;let nv=tN(function(){return d?nf.exports:(d=1,nf.exports=function(){function e(e){return e=JSON.stringify(e),!!/^\{[\s\S]*\}$/.test(e)}function t(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}}function i(e){return"[object Function]"===({}).toString.call(e)}var r=function(e){var t="_Is_Incognit";try{e||(e=window.localStorage),e.setItem(t,"yes"),e.removeItem(t)}catch(t){var i={};i._data={},i.setItem=function(e,t){return i._data[e]=String(t)},i.getItem=function(e){return i._data.hasOwnProperty(e)?i._data[e]:void 0},i.removeItem=function(e){return delete i._data[e]},i.clear=function(){return i._data={}},e=i}finally{"yes"===e.getItem(t)&&e.removeItem(t)}return e}();function n(){if(!(this instanceof n))return new n}n.prototype={set:function(t,i){if(t&&!e(t))r.setItem(t,void 0===i||"function"==typeof i?i+"":JSON.stringify(i));else if(e(t))for(var n in t)this.set(n,t[n]);return this},get:function(e){if(void 0===e){var i={};return this.forEach(function(e,t){return i[e]=t}),i}if("?"===e.charAt(0))return this.has(e.substr(1));var n=arguments;if(n.length>1){for(var s={},a=0,o=n.length;a<o;a++){var l=t(r.getItem(n[a]));this.has(n[a])&&(s[n[a]]=l)}return s}return t(r.getItem(e))},clear:function(){return r.clear(),this},remove:function(e){var t=this.get(e);return r.removeItem(e),t},has:function(e){return({}).hasOwnProperty.call(this.get(),e)},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},forEach:function(e){for(var t=0,i=r.length;t<i;t++){var n=r.key(t);e(n,this.get(n))}return this},search:function(e){for(var t=this.keys(),i={},r=0,n=t.length;r<n;r++)t[r].indexOf(e)>-1&&(i[t[r]]=this.get(t[r]));return i},len:function(){return r.length}};var s=null;function a(t,r){var o=arguments,l=null;if(s||(s=n()),0===o.length)return s.get();if(1===o.length){if("string"==typeof t)return s.get(t);if(e(t))return s.set(t)}if(2===o.length&&"string"==typeof t){if(!r)return s.remove(t);if(r&&"string"==typeof r)return s.set(t,r);r&&i(r)&&(l=null,l=r(t,s.get(t)),a.set(t,l))}if(2===o.length&&"[object Array]"===Object.prototype.toString.call(t)&&i(r))for(var u=0,c=t.length;u<c;u++)l=r(t[u],s.get(t[u])),a.set(t[u],l);return a}for(var o in n.prototype)a[o]=n.prototype[o];return a}(),nf.exports)}()),ny=()=>!(e=>null==e)(globalThis.navigator.userAgentData),nm={URL:()=>!k(globalThis.URL)||!k(globalThis.URLSearchParams),Promise:()=>!k(globalThis.Promise),"Number.isNaN":()=>!k(globalThis.Number.isNaN),"Number.isInteger":()=>!k(globalThis.Number.isInteger),"Array.from":()=>!k(globalThis.Array.from),"Array.prototype.find":()=>!k(globalThis.Array.prototype.find),"Array.prototype.includes":()=>!k(globalThis.Array.prototype.includes),"String.prototype.endsWith":()=>!k(globalThis.String.prototype.endsWith),"String.prototype.startsWith":()=>!k(globalThis.String.prototype.startsWith),"String.prototype.includes":()=>!k(globalThis.String.prototype.includes),"String.prototype.replaceAll":()=>!k(globalThis.String.prototype.replaceAll),"String.fromCodePoint":()=>!k(globalThis.String.fromCodePoint),"Object.entries":()=>!k(globalThis.Object.entries),"Object.values":()=>!k(globalThis.Object.values),"Object.assign":()=>!k(globalThis.Object.assign),"Object.fromEntries":()=>!k(globalThis.Object.fromEntries),"Element.prototype.dataset":()=>!(()=>{let e=globalThis.document.createElement("div");return e.setAttribute("data-a-b","c"),!!e.dataset&&"c"===e.dataset.aB})(),TextEncoder:()=>!k(globalThis.TextEncoder)||!k(globalThis.TextDecoder),requestAnimationFrame:()=>!k(globalThis.requestAnimationFrame)||!k(globalThis.cancelAnimationFrame),CustomEvent:()=>!k(globalThis.CustomEvent),"navigator.sendBeacon":()=>!k(globalThis.navigator.sendBeacon),ArrayBuffer:()=>!k(globalThis.Uint8Array),Set:()=>!k(globalThis.Set),atob:()=>!k(globalThis.atob)},nb=()=>({width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight}),nE=e=>e instanceof DOMException&&(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].includes(e.name)||[22,1014].includes(e.code)),nI=(e=it,t,i)=>{let r,n,s,a=`${V}:: The "${e}" storage type is `,o="unavailable",l=!0;try{switch(e){case ir:return!0;case ie:r=t,n="test_rudder_cookie";break;case it:r=t??globalThis.localStorage,n="test_rudder_ls";break;case ii:r=t??globalThis.sessionStorage,n="test_rudder_ss";break;default:return!1}if(r&&(r.setItem(n,"true"),r.getItem(n)))return r.removeItem(n),!0;l=!1}catch(e){l=!1,s=e,nE(e)&&(o="full")}return l||i?.warn(`${a}${o}.`,s),!1};class nk{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isSupportAvailable=nI(it),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){nv.set(e,t),this.length=nv.len()}getItem(e){let t=nv.get(e);return void 0===t?null:t}removeItem(e){nv.remove(e),this.length=nv.len()}clear(){nv.clear(),this.length=0}key(e){return this.keys()[e]??null}keys(){return nv.keys()}}let nS=new nk(e8);class nA{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isSupportAvailable=nI(ii),this.isSupportAvailable&&(this.store=globalThis.sessionStorage),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store&&(this.store.setItem(e,t),this.length=this.store.length)}getItem(e){if(!this.store)return null;let t=this.store.getItem(e);return void 0===t?null:t}removeItem(e){this.store&&(this.store.removeItem(e),this.length=this.store.length)}clear(){this.store?.clear(),this.length=0}key(e){return this.store?.key(e)??null}keys(){let e=[];if(!this.store)return e;for(let t=0;t<this.store.length;t+=1){let i=this.store.key(t);null!==i&&e.push(i)}return e}}let nT=new nA(e8);class nw{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.logger=e}configure(e){return this.options||(this.options=(()=>{let e=`.${(e=>{let t=(e=>{let t="function"!=typeof globalThis.URL?(e=>{let t=document.createElement("a");return t.href=e,t.hostname})(e):new URL(e).hostname,i=t?.split(".")??[],r=i[i.length-1],n=[];if(4===i.length&&r&&r===parseInt(r,10).toString())return n;if(i.length<=1)return i[0]&&-1!==i[0].indexOf("localhost")?["localhost"]:n;for(let e=i.length-2;e>=0;e-=1)n.push(i.slice(e).join("."));return n})(e);for(let e=0;e<t.length;e+=1){let i=t[e],r="__tld__",n={domain:`${-1!==i.indexOf("localhost")?"":"."}${i}`};try{if(ih(r,1,n),ih(r))return ih(r,null,n),i}catch{try{ih(r,null,n)}catch{}}}return""})(globalThis.location.href)}`;return{maxage:31536e6,path:"/",domain:e&&"."!==e?e:void 0,samesite:"Lax",enabled:!0}})()),this.options=O(this.options,e??{}),this.options.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=nI(ie,this),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return ih(e,t,this.options,this.logger),this.length=Object.keys(ih()).length,!0}getItem(e){let t=ih(e);return void 0===t?null:t}removeItem(e){let t=this.setItem(e,null);return this.length=Object.keys(ih()).length,t}clear(){}key(e){return this.keys()[e]??null}keys(){return Object.keys(ih())}}let nC=new nw(e8),nD=e=>{switch(e){case it:return nS;case ii:return nT;case ir:return np;case ie:return nC;default:return np}};class nP{constructor(e,t,i){this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t,this.noKeyValidation=0===Object.keys(this.validKeys).length,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler,this.logger=e.logger,this.pluginsManager=i}createValidKey(e){let t,{name:i,id:r,validKeys:n,noKeyValidation:s,noCompoundKey:a}=this;return s?a?e:[i,r,e].join("."):(Object.values(n).forEach(n=>{n===e&&(t=a?e:[i,r,e].join("."))}),t)}swapQueueStoreToInMemoryEngine(){let{name:e,id:t,validKeys:i,noCompoundKey:r}=this,n=nD(ir);Object.keys(i).forEach(s=>{let a=this.get(i[s]),o=r?s:[e,t,s].join(".");n.setItem(o,a),this.remove(s)}),this.engine=n}set(e,t){let i=this.createValidKey(e);if(i)try{this.engine.setItem(i,this.encrypt(ef(t,!1,[],this.logger)))}catch(i){if(nE(i)){let i;this.logger.warn((i=`Store ${this.id}`,`${i}:: The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`)),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)}else{let t=`Failed to save the value for "${e}" to storage`;this.onError(i,t,t)}}}get(e){let t,i=this.createValidKey(e);try{if(!i)return null;if(t=this.decrypt(this.engine.getItem(i)),null==t||""===t)return null;return JSON.parse(t)}catch(i){let t=`Failed to retrieve or parse data for "${e}" from storage`;return this.onError(i,t,t),null}}remove(e){let t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return null==e?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){if(!this.isEncrypted||!e||"string"!=typeof e||""===e.replace(/^\s+|\s+$/gm,""))return e;let i=`storage.${t}`,r=this.pluginsManager?this.pluginsManager.invokeSingle(i,e):e;return void 0===r?e:r??""}onError(e,t,i){this.errorHandler.onError({error:e,context:`Store ${this.id}`,customMessage:t,groupingHash:i})}}class nO{stores={};isInitialized=!1;constructor(e,t,i){this.errorHandler=t,this.logger=i,this.pluginsManager=e}init(){if(this.isInitialized)return;let e=tM.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly},localStorageOptions:{},inMemoryStorageOptions:{},sessionStorageOptions:{}};((e={},t={},i={},r={})=>{(e=>{let t=nC.configure(e);tM.storage.cookie.value={maxage:t.maxage,path:t.path,domain:t.domain,samesite:t.samesite,expires:t.expires,secure:t.secure}})(e),nS.configure(t),np.configure(i),nT.configure(r)})(x(O(t.cookieStorageOptions??{},tM.storage.cookie?.value??{})),x(t.localStorageOptions),x(t.inMemoryStorageOptions),x(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState(),[ir,it,ie,ii].forEach(e=>{nD(e)?.isEnabled&&this.setStore({id:nh[e],name:nh[e],isEncrypted:!0,noCompoundKey:!0,type:e,errorHandler:this.errorHandler,logger:this.logger})})}initializeStorageState(){let e=tM.storage.type.value,t=tM.loadOptions.value.storage?.entries,i=tM.consents.postConsent.value.storage;(A(i?.type)||A(i?.entries))&&(e=i?.type,t=i?.entries);let r=!0,n={};nd.forEach(i=>{let s=t?.[i]?.type,a=((e,t)=>{let i;if(e.consents.preConsent.value.enabled)switch(e.consents.preConsent.value.storage?.strategy){case"none":i=is;break;case"session":"sessionInfo"!==t&&(i=is);break;case"anonymousId":"anonymousId"!==t&&(i=is)}return i})(tM,i)??s??e??te,o=this.getResolvedStorageTypeForEntry(a,i);o!==is&&(r=!1),n={...n,[i]:{type:o,key:ig[i]}}}),eL(()=>{tM.storage.type.value=e,tM.storage.entries.value=n,tM.storage.trulyAnonymousTracking.value=r})}getResolvedStorageTypeForEntry(e,t){let i,r=e;switch(e){case it:nD(it)?.isEnabled||(r=ir);break;case ii:nD(ii)?.isEnabled||(r=ir);break;case ir:case is:break;default:r=nD(ie)?.isEnabled?ie:nD(it)?.isEnabled?it:nD(ii)?.isEnabled?ii:ir}return r!==e&&this.logger.warn((i=r,`StoreManager:: The storage type "${e}" is not available for entry "${t}". The SDK will initialize the entry with "${i}" storage type instead.`)),r}setStore(e){let t=nD(e.type);return this.stores[e.id]=new nP(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}}let nR=e=>{let{host:t,protocol:i}=new URL(e),r=t.split(".");return{topDomain:r.length>2?`${r[r.length-2]}.${r[r.length-1]}`:t,protocol:i}},nx=e=>e?.endsWith("/")?nx(e.substring(0,e.length-1)):e,n$=e=>{try{return new URL(e).host}catch(e){return null}},nM=e=>n$(e)??"",nN="none",n_="immediate",nB=e=>R(e)||Array.isArray(e),nL=(e,t)=>{let i,r,n=[],s=[],a=!1,o=e?.enabled===!0;R(e)&&o&&({provider:r,consentManagerPluginName:i}=((e,t)=>{let{provider:i}=e,r=i?tp[i]:void 0;if(i&&!r){let e;t.error((e=i,`${q}:: The consent manager "${e}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(tp)}".`)),i=void 0}return{provider:i,consentManagerPluginName:r}})(e,t),nB(e.allowedConsentIds)&&(n=e.allowedConsentIds,a=!0),nB(e.deniedConsentIds)&&(s=e.deniedConsentIds,a=!0));let l={allowedConsentIds:n,deniedConsentIds:s};return o=o&&!!i,{provider:r,consentManagerPluginName:i,initialized:a,enabled:o,consentsData:l}};class nU{constructor(e,t,i){this.errorHandler=t,this.logger=i,this.httpClient=e,this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){e2(()=>{this.logger.setMinLogLevel(tM.lifecycle.logLevel.value)})}init(){let e,{logLevel:t,configUrl:i,lockIntegrationsVersion:r,lockPluginsVersion:n,destSDKBaseURL:s,pluginsSDKBaseURL:a,integrations:o}=tM.loadOptions.value,l=((e,t,i,r,n,s,a)=>{let o;if(s){if(!io(s))return a.error(`${q}:: The base URL "${s}" for ${e} is not valid.`),null;o=nx(s)}else if(o=i,"cdn"===tM.context.app.value.installType){let e=(()=>{let e=document.querySelector("script[data-rsa-write-key]");if(e&&e.dataset.rsaWriteKey===tM.lifecycle.writeKey.value)return e.src;let t=document.getElementsByTagName("script"),i=/(?:^|\/)rsa(\.min)?\.js$/;for(let e of t){let t=e.getAttribute("src");if(t&&i.test(t))return t}})();e&&(o=e.split("/").slice(0,-1).concat(t).join("/"))}return n&&(o=o.replace(RegExp(`/v3/${tu}/${t}$`),`/${r}/${tu}/${t}`)),o})("integrations",to,td,eS,r,s,this.logger);null!==l&&(this.attachEffects(),tM.lifecycle.activeDataplaneUrl.value=nx(tM.lifecycle.dataPlaneUrl.value),(e=>{let t,i,{storage:r}=tM.loadOptions.value,n=r?.type;if(A(n)&&!("string"==typeof(i=n)&&e7.includes(i))){let t;e.warn((t=n,`${q}:: The storage type "${t}" is not supported. Please choose one of the following supported types: "${e7}". The default type "${te}" will be used instead.`)),n=te}let s=r?.encryption?.version,a=s&&tf[s];if(void 0===s||void 0!==a)void 0===s&&(s="v3");else{let t;e.warn((t=s,`${q}:: The storage encryption version "${t}" is not supported. Please choose one of the following supported versions: "${Object.keys(tf)}". The default version "v3" will be used instead.`)),s="v3"}let o=r?.migrate,l=o&&"v3"===s;!0===o&&l!==o&&e.warn((t=s,`${q}:: The storage data migration has been disabled because the configured storage encryption version (${t}) is not the latest (v3). To enable storage data migration, please update the storage encryption version to the latest version.`));let{sscEnabled:u,finalDataServiceUrl:c,cookieOptions:d}=(e=>{let t,{useServerSideCookies:i,dataServiceEndpoint:r,storage:n,setCookieDomain:s,sameDomainCookiesOnly:a}=tM.loadOptions.value,o=n?.cookie,l=!1;if(i){l=i;let n=o.domain??s,u=A(n)&&!(e=>{let{topDomain:t}=nR(window.location.href);return t===e})(B(n))||a,c=((e,t)=>{let i=t?window.location.origin:(e=>{let{topDomain:t,protocol:i}=nR(e);return`${i}//${t}`})(window.location.href),r=e.startsWith("/")?e.substring(1):e;return`${i}/${r}`})(r??"rsaRequest",u);if(io(c)){t=nx(c);let i=n$(window.location.href),r=n$(c);(i!==r&&(o={...o,samesite:"None",secure:!0}),!a&&u&&r!==B(n))&&(l=!1,e.warn(`${q}:: The provided cookie domain (${n}) does not match the current webpage's domain (${r}). Hence, the cookies will be set client-side.`))}else l=!1}return{sscEnabled:l,cookieOptions:o,finalDataServiceUrl:t}})(e);eL(()=>{tM.storage.type.value=n,tM.storage.cookie.value=d,tM.serverCookies.isEnabledServerSideCookies.value=u,tM.serverCookies.dataServiceUrl.value=c,tM.storage.encryptionPluginName.value=tf[s],tM.storage.migrate.value=l})})(this.logger),(e=>{let{provider:t,consentManagerPluginName:i,initialized:r,enabled:n,consentsData:s}=nL(tM.loadOptions.value.consentManagement,e),a=tM.loadOptions.value.preConsent,o=a?.storage?.strategy??nN;if(A(o)&&!["none","session","anonymousId"].includes(o)){let t;o=nN,e.warn((t=a?.storage?.strategy,`${q}:: The pre-consent storage strategy "${t}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${nN}" will be used instead.`))}let l=a?.events?.delivery??n_;if(A(l)&&!["immediate","buffer"].includes(l)){let t;l=n_,e.warn((t=a?.events?.delivery,`${q}:: The pre-consent events delivery type "${t}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${n_}" will be used instead.`))}eL(()=>{tM.consents.activeConsentManagerPluginName.value=i,tM.consents.initialized.value=r,tM.consents.enabled.value=n,tM.consents.data.value=s,tM.consents.provider.value=t,tM.consents.preConsent.value={enabled:tM.loadOptions.value.preConsent?.enabled===!0&&!1===r&&!0===n,storage:{strategy:o},events:{delivery:l}}})})(this.logger),(e=>{if(tM.dataPlaneEvents.deliveryEnabled.value){let t="XhrQueue",i=t;if(tM.loadOptions.value.useBeacon)if(tM.capabilities.isBeaconAvailable.value)i="BeaconQueue";else i=t,e.warn(`${q}:: The Beacon API is not supported by your browser. The events will be sent using XHR instead.`);eL(()=>{tM.dataPlaneEvents.eventsQueuePluginName.value=i})}})(this.logger),eL(()=>{tM.lifecycle.integrationsCDNPath.value=l,tM.lifecycle.pluginsCDNPath.value=e,t&&(tM.lifecycle.logLevel.value=t),tM.lifecycle.sourceConfigUrl.value=((e,t,i,r,n)=>{let s=new URLSearchParams({p:"npm",v:eS,build:tu,writeKey:t,lockIntegrationsVersion:i.toString(),lockPluginsVersion:r.toString()}),a=tg,o=s,l="/sourceConfig/",u="";if(io(e)){let t=new URL(e);nx(t.pathname).endsWith("/sourceConfig")||(t.pathname=`${nx(t.pathname)}/sourceConfig/`),t.pathname=ia(t.pathname),s.forEach((e,i)=>{null===t.searchParams.get(i)&&t.searchParams.set(i,e)}),a=t.origin,l=t.pathname,o=t.searchParams,u=t.hash}else n.warn(`${q}:: The provided source config URL "${e}" is invalid. Using the default source config URL instead.`);return`${a}${l}?${o}${u}`})(i,tM.lifecycle.writeKey.value,r,n,this.logger),tM.metrics.metricsServiceUrl.value=`${tM.lifecycle.activeDataplaneUrl.value}/rsaMetrics`,tM.nativeDestinations.loadOnlyIntegrations.value=o}),this.getConfig())}onError(e,t,i){this.errorHandler.onError({error:e,context:q,customMessage:t,groupingHash:i})}processConfig(e,t){var i;let r,n,s,a,o;if(!A(e))return void(A(t)?this.onError(t.error,tr):this.onError(Error(tr)));try{r=S(e)?JSON.parse(e):e}catch(e){this.onError(e,tt);return}if(!(D(n=r)&&D(n.source)&&null!=(o=n.source.id)&&D(n.source.config)&&Array.isArray(n.source.destinations)))return void this.onError(Error(tt));if(!1===r.source.enabled)return void this.logger.error("The source is disabled. Please enable the source in the dashboard to send events.");i=r,tM.reporting.isErrorReportingEnabled.value=(s=i.source.config,s?.statsCollection?.errors?.enabled===!0&&!window.chrome?.runtime?.id),tM.reporting.isMetricsReportingEnabled.value=(a=i.source.config,a?.statsCollection?.metrics?.enabled===!0);let l=r.source.destinations.length>0?r.source.destinations.map(e=>{let t,i;return{id:e.id,displayName:e.destinationDefinition.displayName,enabled:e.enabled,config:e.config,shouldApplyDeviceModeTransformation:e.shouldApplyDeviceModeTransformation??!1,propagateEventsUntransformedOnError:e.propagateEventsUntransformedOnError??!1,userFriendlyId:(t=e.destinationDefinition.displayName,i=e.id,`${t.replaceAll(" ","-")}___${i}`),isCustomIntegration:"Custom Device Mode"===e.destinationDefinition.displayName}}):[];eL(()=>{var e;let t,i;tM.source.value={config:r.source.config,name:r.source.name,id:r.source.id,workspaceId:r.source.workspaceId},tM.nativeDestinations.configuredDestinations.value=l,tM.plugins.pluginsToLoadFromConfig.value=tM.loadOptions.value.plugins??[],e=r,i=tM.consents.resolutionStrategy.value,D(e.consentManagementMetadata)&&(tM.consents.provider.value&&(i=e.consentManagementMetadata.providers.find(e=>e.provider===tM.consents.provider.value)?.resolutionStrategy??tM.consents.resolutionStrategy.value),t=e.consentManagementMetadata),"custom"===tM.consents.provider.value&&(i=void 0),eL(()=>{tM.consents.metadata.value=v(t),tM.consents.resolutionStrategy.value=i}),tM.lifecycle.status.value="configured"})}getConfig(){let e=tM.loadOptions.value.getSourceConfig;if(e){if(!k(e))return void this.logger.error(`${q}:: The "getSourceConfig" load API option must be a function that returns valid source configuration data.`);let t=e();t instanceof Promise?t.then(e=>this.processConfig(e)).catch(e=>{this.onError(e,"SourceConfig")}):this.processConfig(t)}else this.httpClient.getAsyncData({url:tM.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}let nj=(e=()=>document)=>e()?.referrer||"$direct",nH=(e=()=>globalThis.location,t=()=>document)=>{let i=e(),r=((e=()=>document)=>{let t=e().getElementsByTagName("link"),i="";for(let e=0;t[e];e+=1){let r=t[e];if("canonical"===r.getAttribute("rel")&&!i){i=r.getAttribute("href")??"";break}}return i})(t),n=i.pathname,{href:s}=i,a=s,{search:o}=i;if(r)try{let e=new URL(r);a=""===e.search?r+o:r,n=e.pathname}catch(e){}let l=(e=>{let t=e;try{let i=new URL(e);t=i.origin+i.pathname+i.search}catch(e){}return t})(a),{title:u}=t(),c=nj(t);return{path:n,referrer:c,referring_domain:nM(c),search:o,title:u,url:l,tab_url:s}},nF=`https://polyfill-fastly.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(nm).join("%2C")}`,nz="rudderstackPolyfill";class nQ{constructor(e,t,i){this.httpClient=e,this.errorHandler=t,this.logger=i,this.externalSrcLoader=new eN(this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){this.prepareBrowserCapabilities(),this.attachWindowListeners()}detectBrowserCapabilities(){eL(()=>{let e,t;tM.capabilities.storage.isCookieStorageAvailable.value=nI(ie,nD(ie),this.logger),tM.capabilities.storage.isLocalStorageAvailable.value=nI(it,void 0,this.logger),tM.capabilities.storage.isSessionStorageAvailable.value=nI(ii,void 0,this.logger),tM.capabilities.isBeaconAvailable.value=null!=(e=globalThis.navigator.sendBeacon)&&k(globalThis.navigator.sendBeacon),tM.capabilities.isUaCHAvailable.value=ny(),tM.capabilities.isCryptoAvailable.value=null!=(t=globalThis.crypto)&&k(globalThis.crypto.getRandomValues),tM.capabilities.isIE11.value=eu(),tM.capabilities.isOnline.value=globalThis.navigator.onLine,tM.context.userAgent.value=((e=()=>globalThis.navigator)=>{let t=e();if(void 0===t)return null;let{userAgent:i}=t,{brave:r}=t;if(r&&Object.getPrototypeOf(r).isBrave){let e=i.match(/(chrome)\/([\w.]+)/i);e&&(i=`${i} Brave/${e[2]}`)}return i})(),tM.context.locale.value=((e=()=>globalThis.navigator)=>{let t=e();return void 0===t?null:t.language??t.browserLanguage})(),tM.context.screen.value=nb(),tM.context.timezone.value=(()=>{let e=/([A-Z]+[+-]\d+)/.exec(new Date().toString());return e?.[1]?e[1]:"NA"})(),ny()&&((e,t="none")=>{"none"===t&&e(void 0),"default"===t&&e(navigator.userAgentData),"full"===t&&navigator.userAgentData?.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then(t=>{e(t)}).catch(()=>{e()})})(e=>{tM.context["ua-ch"].value=e},tM.loadOptions.value.uaChTrackLevel)}),e2(()=>{!0===tM.loadOptions.value.sendAdblockPage&&void 0!==tM.lifecycle.sourceConfigUrl.value&&t0(this.httpClient)})}prepareBrowserCapabilities(){tM.capabilities.isLegacyDOM.value=(()=>{let e=Object.keys(nm),t=!1;for(let i=0;i<e.length;i++){let r=nm[e[i]];if(k(r)&&r()){t=!0;break}}return t})();let e=tM.loadOptions.value.polyfillURL,t=nF;if(T(e))if(io(e))t=e;else this.logger.warn(`${V}:: The provided polyfill URL "${e}" is invalid. The default polyfill URL will be used instead.`);if(tM.loadOptions.value.polyfillIfRequired&&tM.capabilities.isLegacyDOM.value&&io(t)){let e=t!==tM.loadOptions.value.polyfillURL;if(e){let e=`RS_polyfillCallback_${tM.lifecycle.writeKey.value}`,i=()=>{this.onReady(),delete globalThis[e]};globalThis[e]=i,t=`${t}&callback=${e}`}this.externalSrcLoader.loadJSFile({url:t,id:nz,async:!0,timeout:1e4,callback:i=>{if(i)e||this.onReady();else{let e;this.onError(Error((e=t,`Failed to load the polyfill script with ID "${nz}" from URL ${e}.`)))}}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",()=>{tM.capabilities.isOnline.value=!1}),globalThis.addEventListener("online",()=>{tM.capabilities.isOnline.value=!0}),globalThis.addEventListener("resize",function(e,t,i=250){let r;return(...n)=>{globalThis.clearTimeout(r),r=globalThis.setTimeout(()=>{e.apply(t,n)},i)}}(()=>{tM.context.screen.value=nb()},this))}onReady(){this.detectBrowserCapabilities(),tM.lifecycle.status.value="browserCapabilitiesReady"}onError(e,t){this.errorHandler.onError({error:e,context:V,groupingHash:t})}}let nG=["integrations","anonymousId","originalTimestamp"],nK=["library","consentManagement","userAgent","ua-ch","screen"],nV=["id","anonymous_id","user_id","sent_at","timestamp","received_at","original_timestamp","event","event_text","channel","context_ip","context_request_ip","context_passed_ip","group_id","previous_id"],nq=e=>"number"==typeof e&&!Number.isNaN(e),nW=e=>nq(e)&&e>=0&&Number.isInteger(e),nJ=e=>{let{cutOff:t}=e,i=Date.now();return!!(t?.enabled&&t.expiresAt&&i>t.expiresAt)},nX=e=>!!(!e.expiresAt||Date.now()>e.expiresAt)||nJ(e),nZ=e=>e===ie||e===it||e===ii||e===ir,nY=()=>el(),n0=(e,t,i)=>{D(e)&&Object.keys(e).forEach(e=>{(nV.includes(e)||nV.includes(e.toLowerCase()))&&i.warn(`${W}:: The "${e}" property defined under "${t}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${nV}).`)})},n1=(e,t,i,r)=>{let n={channel:"web",context:{traits:v(tM.session.userTraits.value),sessionId:tM.session.sessionInfo.value.id||void 0,sessionStart:tM.session.sessionInfo.value.sessionStart||void 0,...tM.consents.enabled.value&&{consentManagement:{deniedConsentIds:v(tM.consents.data.value.deniedConsentIds),allowedConsentIds:v(tM.consents.data.value.allowedConsentIds),provider:tM.consents.provider.value,resolutionStrategy:tM.consents.resolutionStrategy.value}},"ua-ch":tM.context["ua-ch"].value,app:tM.context.app.value,library:tM.context.library.value,userAgent:tM.context.userAgent.value,os:tM.context.os.value,locale:tM.context.locale.value,screen:tM.context.screen.value,campaign:(e=>{let t={};try{let i=new URL(e),r="utm_";i.searchParams.forEach((e,i)=>{if(i.startsWith(r)){let n=i.substring(r.length);"campaign"===n&&(n="name"),t[n]=e}})}catch(e){}return t})(globalThis.location.href),page:(e=>{let t=nH(),i={};return Object.keys(t).forEach(r=>{i[r]=e?.[r]||t[r]}),i.initial_referrer=e?.initial_referrer||tM.session.initialReferrer.value,i.initial_referring_domain=e?.initial_referring_domain||tM.session.initialReferringDomain.value,i})(i),timezone:tM.context.timezone.value,...tM.autoTrack.enabled.value&&{autoTrack:{...tM.autoTrack.pageLifecycle.enabled.value&&{page:{pageViewId:tM.autoTrack.pageLifecycle.pageViewId.value}}}}},originalTimestamp:eh(),messageId:el(),userId:e.userId||tM.session.userId.value};nZ(tM.storage.entries.value.anonymousId?.type)?n.anonymousId=tM.session.anonymousId.value:n.anonymousId=nY(),tM.storage.trulyAnonymousTracking.value&&(n.context.trulyAnonymousTracking=!0),"identify"===e.type&&(n.context.traits=tM.storage.entries.value.userTraits?.type!==is?v(tM.session.userTraits.value):e.context.traits),"group"===e.type&&((e.groupId||tM.session.groupId.value)&&(n.groupId=e.groupId||tM.session.groupId.value),(e.traits||tM.session.groupTraits.value)&&(n.traits=tM.storage.entries.value.groupTraits?.type!==is?v(tM.session.groupTraits.value):e.traits));let s=O(e,n);return void 0===s.event&&(s.event=null),void 0===s.properties&&(s.properties=null),((e,t,i)=>{D(t)&&(((e,t)=>{t.anonymousId&&S(t.anonymousId)&&(e.anonymousId=t.anonymousId),R(t.integrations)&&(e.integrations=t.integrations),t.originalTimestamp&&S(t.originalTimestamp)&&(e.originalTimestamp=t.originalTimestamp)})(e,t),e.context=((e,t,i)=>{let r=e;return Object.keys(t).forEach(e=>{if(!nG.includes(e)&&!nK.includes(e))if("context"!==e)r=O(r,{[e]:t[e]});else if(void 0!==t[e]&&D(t[e])){let i={};Object.keys(t[e]).forEach(r=>{nK.includes(r)||(i[r]=t[e][r])}),r=O(r,{...i})}else i.warn(`${W}:: Please make sure that the "context" property in the event API's "options" argument is a valid object literal with key-value pairs.`)}),r})(e.context,t,i))})(s,t,r),((e,t)=>{let{properties:i,traits:r,context:n}=e,{traits:s}=n;n0(i,"properties",t),n0(r,"traits",t),n0(s,"context.traits",t)})(s,r),s.integrations=(e=>v(tM.loadOptions.value.useGlobalIntegrationsConfigInEvents?tM.consents.postConsent.value.integrations??tM.nativeDestinations.loadOnlyIntegrations.value:e||ta))(s.integrations),s};class n2{constructor(e){this.logger=e}generatePageEvent(e,t,i,r){let n=i??{};return n1({properties:n=((e,t)=>{let i=t?.page||{},r=nH();return Object.keys(r).forEach(t=>{void 0===e[t]&&(e[t]=i[t]||r[t])}),void 0===e.initial_referrer&&(e.initial_referrer=i.initial_referrer||tM.session.initialReferrer.value),void 0===e.initial_referring_domain&&(e.initial_referring_domain=i.initial_referring_domain||tM.session.initialReferringDomain.value),e})(n,r),name:t,category:e,type:"page"},r,n,this.logger)}generateTrackEvent(e,t,i){return n1({properties:t,event:e,type:"track"},i,void 0,this.logger)}generateIdentifyEvent(e,t,i){return n1({userId:e,type:"identify",context:{traits:t}},i,void 0,this.logger)}generateAliasEvent(e,t,i){let r=n1({previousId:t,type:"alias"},i,void 0,this.logger);return r.userId=e??r.userId,r}generateGroupEvent(e,t,i){let r={type:"group"};return e&&(r.groupId=e),t&&(r.traits=t),n1(r,i,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;default:t=this.generateGroupEvent(e.groupId,e.traits,e.options)}return t}}class n4{constructor(e,t,i,r){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=i,this.logger=r,this.eventFactory=new n2(this.logger)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();let t=this.eventFactory.create(e);this.eventRepository.enqueue(t,e.callback)}}class n5{constructor(e,t,i,r,n){this.storeManager=t,this.pluginsManager=e,this.logger=n,this.errorHandler=r,this.httpClient=i,this.onError=this.onError.bind(this),this.serverSideCookieDebounceFuncs={}}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){let e;this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits());let{externalAnonymousIdCookieName:t,anonymousIdOptions:i}=tM.loadOptions.value;T(t)&&"string"==typeof t&&(e=this.getExternalAnonymousIdByCookieName(t)),this.setAnonymousId(e??this.getAnonymousId(i)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e;if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){let t=this.getConfiguredSessionTrackingInfo(),i=this.getSessionInfo()??tm.sessionInfo;(e={autoTrack:t.autoTrack&&!0!==i.manualTrack,timeout:t.timeout,manualTrack:i.manualTrack,expiresAt:i.expiresAt,id:i.id,sessionStart:i.sessionStart}).autoTrack||!0===e.manualTrack?t.cutOff?.enabled===!0&&(e.cutOff={enabled:!0,duration:t.cutOff.duration,expiresAt:i.cutOff?.expiresAt}):e=tm.sessionInfo}else e=tm.sessionInfo;tM.session.sessionInfo.value=e,tM.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking(tM.session.sessionInfo.value)}setInitialReferrerInfo(){let e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{let t=e||nj();this.setInitialReferrer(t),this.setInitialReferringDomain(nM(t))}}isPersistenceEnabledForStorageEntry(e){return nZ(tM.storage.entries.value[e]?.type)}migrateDataFromPreviousStorage(){let e=tM.storage.entries.value,t=[ie,it,ii];Object.keys(e).forEach(i=>{let r=e[i]?.type,n=this.storeManager?.getStore(nh[r]);n&&t.forEach(e=>{let t=this.storeManager?.getStore(nh[e]);if(t&&e!==r){let e=t.get(ig[i]);T(e)&&""!==e&&n.set(ig[i],e),t.remove(ig[i])}})})}migrateStorageIfNeeded(e,t){if(!tM.storage.migrate.value)return;let i=e??[];0===i.length&&[nl,nu,nc].forEach(e=>{let t=this.storeManager?.getStore(e);t&&i.push(t)}),(t??Object.keys(ig)).forEach(e=>{let t=ig[e];i.forEach(e=>{let i=this.pluginsManager?.invokeSingle("storage.migrate",t,e.engine,this.errorHandler,this.logger);null==i||e.set(t,i)})})}getConfiguredSessionTrackingInfo(){let e,t,i=!1!==tM.loadOptions.value.sessions.autoTrack;if(!i)return{autoTrack:i};let r=tM.loadOptions.value.sessions?.timeout;if(nW(r))t=r;else this.logger.warn(`${X}:: The session timeout value "${r}" is not a number. The default timeout of 1800000 ms will be used instead.`),t=18e5;0===t&&(this.logger.warn(`${X}:: The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`),i=!1);t>0&&t<1e4&&this.logger.warn((e=t,`${X}:: The session timeout value ${e} ms is less than the recommended minimum of 10000 ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`));let n=this.getCutOffInfo(t);return{timeout:t,autoTrack:i,cutOff:n}}getCutOffInfo(e){let t,i=tM.loadOptions.value.sessions.cutOff,r=!1;if(!0===i.enabled)if(t=i.duration,r=!0,nW(t)){if(t<e){let i;this.logger.warn((i=t,`${X}:: The session cut off duration value "${i}" ms is less than the session timeout value "${e}" ms. The cut off functionality will be disabled.`)),r=!1}}else{let e;this.logger.warn((e=t,`${X}:: The session cut off duration value "${e}" is not a number. The default cut off duration of 43200000 ms will be used instead.`)),t=432e5}return{enabled:r,duration:t}}onError(e,t,i){this.errorHandler.onError({error:e,context:X,customMessage:t,groupingHash:i})}getEncryptedCookieData(e,t){let i=[];return e.forEach(e=>{let r=t?.encrypt(ef(e.value,!1,[],this.logger));T(r)&&i.push({name:e.name,value:r})}),i}makeRequestToSetCookie(e,t){this.httpClient?.getAsyncData({url:tM.serverCookies.dataServiceUrl.value,options:{method:"POST",data:ef({reqType:"setCookies",workspaceId:tM.source.value?.workspaceId,data:{options:{maxAge:tM.storage.cookie.value?.maxage,path:tM.storage.cookie.value?.path,domain:tM.storage.cookie.value?.domain,sameSite:tM.storage.cookie.value?.samesite,secure:tM.storage.cookie.value?.secure,expires:tM.storage.cookie.value?.expires},cookies:e}}),sendRawData:!0,withCredentials:!0},isRawResponse:!0,callback:t})}setServerSideCookies(e,t,i){try{let r=this.getEncryptedCookieData(e,i);r.length>0&&this.makeRequestToSetCookie(r,(r,n)=>{if(n?.xhr?.status===200)e.forEach(e=>{let r=i?.get(e.name),n=ef(e.value,!1,[]);if(ef(r,!1,[])!==n){let i;this.logger.error((i=e.name,`The server failed to set the ${i} cookie. As a fallback, the cookies will be set client side.`)),t&&t(e.name,e.value)}});else{let i;this.logger.error((i=n?.xhr?.status,`The server responded with status ${i} while setting the cookies. As a fallback, the cookies will be set client side.`)),e.forEach(e=>{t&&t(e.name,e.value)})}})}catch(i){this.onError(i,ts,ts),e.forEach(e=>{t&&t(e.name,e.value)})}}syncValueToStorage(e,t){let i=tM.storage.entries.value,r=i[e]?.type;if(nZ(r)){let n=this.storeManager?.getStore(nh[r]),s=i[e]?.key;t&&(S(t)||R(t))?tM.serverCookies.isEnabledServerSideCookies.value&&r===ie?(this.serverSideCookieDebounceFuncs[e]&&globalThis.clearTimeout(this.serverSideCookieDebounceFuncs[e]),this.serverSideCookieDebounceFuncs[e]=globalThis.setTimeout(()=>{this.setServerSideCookies([{name:s,value:t}],(e,t)=>{n?.set(e,t)},n)},10)):n?.set(s,t):n?.remove(s)}}registerEffects(){nd.forEach(e=>{e2(()=>{this.syncValueToStorage(e,tM.session[e].value)})})}setAnonymousId(e,t){let i=e;S(e)&&i||(i=void 0),this.isPersistenceEnabledForStorageEntry("anonymousId")?(!i&&t&&(i=this.pluginsManager?.invokeSingle("userSession.anonymousIdGoogleLinker",t)),i=i||nY()):i=tm.anonymousId,tM.session.anonymousId.value=i}getAnonymousId(e){if(nZ(tM.storage.entries.value.anonymousId?.type)){let t=tM.session.anonymousId.value;t&&t!==tm.anonymousId||(t=this.getEntryValue("anonymousId")),!t&&e&&(t=this.pluginsManager?.invokeSingle("storage.getAnonymousId",nD,e)),tM.session.anonymousId.value=t||nY()}return tM.session.anonymousId.value}getEntryValue(e){let t=tM.storage.entries.value,i=t[e]?.type;if(nZ(i)){let r=this.storeManager?.getStore(nh[i]);this.migrateStorageIfNeeded([r],[e]);let n=t[e]?.key;return r?.get(n)??null}return null}getExternalAnonymousIdByCookieName(e){let t=nD(ie);return t?.isEnabled?t.getItem(e)??null:null}getUserId(){return this.getEntryValue("userId")}getUserTraits(){return this.getEntryValue("userTraits")}getGroupId(){return this.getEntryValue("groupId")}getGroupTraits(){return this.getEntryValue("groupTraits")}getInitialReferrer(){return this.getEntryValue("initialReferrer")}getInitialReferringDomain(){return this.getEntryValue("initialReferringDomain")}getSessionInfo(){return this.getEntryValue("sessionInfo")}getAuthToken(){return this.getEntryValue("authToken")}getSessionId(){let e=this.getSessionInfo()??tm.sessionInfo;return e.autoTrack&&!nX(e)||e.manualTrack?e.id??null:null}refreshSession(){let e=this.getSessionInfo()??tm.sessionInfo;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&(this.startOrRenewAutoTracking(e),e=tM.session.sessionInfo.value),void 0===e.sessionStart?e={...e,sessionStart:!0}:e.sessionStart&&(e={...e,sessionStart:!1})),tM.session.sessionInfo.value=e,"readyExecuted"!==tM.lifecycle.status.value&&this.syncValueToStorage("sessionInfo",e)}resetAndStartNewSession(){let e=tM.session,{manualTrack:t,autoTrack:i,timeout:r,cutOff:n}=e.sessionInfo.value;if(i){let t={...tm.sessionInfo,timeout:r};n&&(t.cutOff={enabled:n.enabled,duration:n.duration}),e.sessionInfo.value=t,this.startOrRenewAutoTracking(e.sessionInfo.value)}else t&&this.startManualTrackingInternal()}reset(e){let{session:t}=tM,i=(e=>{if("boolean"==typeof e){let{entries:t,...i}=tb;return{...i,entries:{...t,anonymousId:e}}}return D(e)&&D(e.entries)?O(tb,e):{...tb}})(e);eL(()=>{Object.keys(tm).forEach(e=>{if(!0===i.entries[e])switch(e){case"anonymousId":this.setAnonymousId();break;case"sessionInfo":this.resetAndStartNewSession();break;default:t[e].value=tm[e]}})})}setUserId(e){tM.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:tm.userId}setUserTraits(e){tM.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&D(e)?O(tM.session.userTraits.value??tm.userTraits,e):tm.userTraits}setGroupId(e){tM.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:tm.groupId}setGroupTraits(e){tM.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&D(e)?O(tM.session.groupTraits.value??tm.groupTraits,e):tm.groupTraits}setInitialReferrer(e){tM.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:tm.initialReferrer}setInitialReferringDomain(e){tM.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:tm.initialReferringDomain}startOrRenewAutoTracking(e){let t=e;if(nX(e))t=(e=>{let{timeout:t,cutOff:i}=e,r=Date.now();return{id:r,expiresAt:r+t,timeout:t,autoTrack:!0,...i&&{cutOff:i}}})(e);else{let i=Date.now(),r=e.timeout;t.expiresAt=i+r}if(nJ(t)&&(t.cutOff.expiresAt=void 0),t.cutOff){let e=(e=>{if(e?.enabled)return e.expiresAt??(nW(e.duration)?Date.now()+e.duration:void 0)})(t.cutOff);t.cutOff.expiresAt=e}tM.session.sessionInfo.value=t}start(e){tM.session.sessionInfo.value={id:((e,t)=>{if(!e||!nW(e)||!(e.toString().length>=10))return t.warn(`${X}:: The provided session ID (${e}) is either invalid, not a positive integer, or not at least "10" digits long. A new session ID will be auto-generated instead.`),!1;return!0})(e,this.logger)?e:Date.now(),sessionStart:void 0,manualTrack:!0}}startManualTrackingInternal(){this.start(Date.now())}end(){tM.session.sessionInfo.value=tm.sessionInfo}setAuthToken(e){tM.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:tm.authToken}}let n6=["BeaconQueue","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],n3="dataplaneEventsQueue",n8="destinationsEventsQueue",n9=(e,t,i,r)=>{if(A(e))if(k(e))try{e(...t)}catch(e){r.error(`${i}:: The callback threw an exception`,e)}else r.error(tn(i))};class n7{constructor(e,t,i,r,n){this.pluginsManager=e,this.errorHandler=r,this.httpClient=i,this.logger=n,this.storeManager=t}init(){let e;this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${n3}.init`,tM,this.httpClient,this.storeManager,this.errorHandler,this.logger),this.dmtEventsQueue=this.pluginsManager.invokeSingle("transformEvent.init",tM,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger),this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${n8}.init`,tM,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger),e2(()=>{!0===tM.nativeDestinations.clientDestinationsReady.value&&(this.destinationsEventsQueue?.start(),this.dmtEventsQueue?.start())});let t=tM.consents.preConsent.value.enabled&&tM.consents.preConsent.value.events?.delivery==="buffer";e2(()=>{let i=!0===tM.loadOptions.value.bufferDataPlaneEventsUntilReady&&!1===tM.nativeDestinations.clientDestinationsReady.value;!1!==tM.nativeDestinations.activeDestinations.value.some(e=>t3(e))&&!1!==i||t||this.dataplaneEventsQueue?.scheduleTimeoutActive===!0||(globalThis.clearTimeout(e),this.dataplaneEventsQueue?.start())}),!0===tM.loadOptions.value.bufferDataPlaneEventsUntilReady&&(e=globalThis.setTimeout(()=>{this.dataplaneEventsQueue?.scheduleTimeoutActive!==!0&&this.dataplaneEventsQueue?.start()},tM.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){this.dataplaneEventsQueue?.scheduleTimeoutActive!==!0&&(tM.consents.postConsent.value.discardPreConsentEvents&&(this.dataplaneEventsQueue?.clear(),this.destinationsEventsQueue?.clear()),this.dataplaneEventsQueue?.start())}enqueue(e,t){let i=((e,t)=>{let i,r,n=v(e),s=t.nativeDestinations.integrationsConfig.value,a=(i=e.integrations,r=s,Object.keys(i).filter(e=>!0!==i[e]||!r[e]).reduce((e,t)=>{let r=v(e);return r[t]=i[t],r},{}));return n.integrations=O(s,a),n})(e,tM);this.pluginsManager.invokeSingle(`${n3}.enqueue`,tM,this.dataplaneEventsQueue,i,this.errorHandler,this.logger);let r=v(e);this.pluginsManager.invokeSingle(`${n8}.enqueue`,tM,this.destinationsEventsQueue,r,this.errorHandler,this.logger),n9(t,[i],`${e.type.charAt(0).toUpperCase()}${e.type.slice(1)}API`,this.logger)}}let se=e=>{let t=new CustomEvent(e,{detail:{analyticsInstance:globalThis.rudderanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(t)};class st{constructor(){this.preloadBuffer=new e4,this.initialized=!1,this.errorHandler=t2,this.logger=e8,this.externalSrcLoader=new eN(this.logger),this.httpClient=tX,this.httpClient.init(this.errorHandler),this.capabilitiesManager=new nQ(this.httpClient,this.errorHandler,this.logger)}load(e,t,i={}){if(!tM.lifecycle.status.value){if(!(S(e)&&e.trim().length>0))return void this.logger.error(`${et}:: The write key "${e}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`);if(!io(t))return void this.logger.error(`${et}:: The data plane URL "${t}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`);eL(()=>{tM.lifecycle.writeKey.value=v(e),tM.lifecycle.dataPlaneUrl.value=v(t),tM.loadOptions.value=((e,t)=>{let i=v(t);return S(i.setCookieDomain)||(i.setCookieDomain=void 0),["Strict","Lax","None"].includes(i.sameSiteCookie)||(i.sameSiteCookie=void 0),i.secureCookie=N(i.secureCookie,e.secureCookie),i.sameDomainCookiesOnly=N(i.sameDomainCookiesOnly,e.sameDomainCookiesOnly),["none","default","full"].includes(i.uaChTrackLevel)||(i.uaChTrackLevel=void 0),i.integrations=M(i.integrations),Array.isArray(i.plugins)||(i.plugins=n6),i.useGlobalIntegrationsConfigInEvents=N(i.useGlobalIntegrationsConfigInEvents,e.useGlobalIntegrationsConfigInEvents),i.bufferDataPlaneEventsUntilReady=N(i.bufferDataPlaneEventsUntilReady,e.bufferDataPlaneEventsUntilReady),i.sendAdblockPage=N(i.sendAdblockPage,e.sendAdblockPage),i.useServerSideCookies=N(i.useServerSideCookies,e.useServerSideCookies),S(i.dataServiceEndpoint)||(i.dataServiceEndpoint=void 0),i.sendAdblockPageOptions=M(i.sendAdblockPageOptions),i.loadIntegration=N(i.loadIntegration,e.loadIntegration),R(i.storage)?(i.storage.migrate=N(i.storage.migrate,e.storage?.migrate),i.storage.cookie=M(i.storage.cookie),i.storage.encryption=M(i.storage.encryption),i.storage=$(i.storage)):i.storage=void 0,i.destinationsQueueOptions=M(i.destinationsQueueOptions),i.queueOptions=M(i.queueOptions),i.lockIntegrationsVersion=N(i.lockIntegrationsVersion,e.lockIntegrationsVersion),i.lockPluginsVersion=N(i.lockPluginsVersion,e.lockPluginsVersion),nq(i.dataPlaneEventsBufferTimeout)||(i.dataPlaneEventsBufferTimeout=void 0),i.beaconQueueOptions=M(i.beaconQueueOptions),i.preConsent=M(i.preConsent),i.sourceConfigurationOverride=M(i.sourceConfigurationOverride),O(e,$(i))})(tM.loadOptions.value,i),tM.lifecycle.status.value="mounted"}),this.logger.setMinLogLevel(tM.loadOptions.value.logLevel??e6),eR("state",tM,e),this.startLifecycle()}}startLifecycle(){e2(()=>{try{switch(tM.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":case"destinationsLoading":break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady()}}catch(t){let e="Failed to load the SDK";this.errorHandler.onError({error:t,context:et,customMessage:e,groupingHash:e})}})}onBrowserCapabilitiesReady(){let e=ex(eT)||[];((e=[])=>{let t="ajs_trait_",i="ajs_prop_",r=new URLSearchParams(globalThis.location.search);r.get(eD)&&e.unshift(["track",r.get(eD),e$(r,i)]),r.get(eC)&&e.unshift(["identify",r.get(eC),e$(r,t)]),r.get(ew)&&e.unshift(["setAnonymousId",r.get(ew)])})(e),e.length>0&&(this.enqueuePreloadBufferEvents(e),eR(eT,[])),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),!0===tM.consents.preConsent.value.enabled?tM.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach(e=>this.preloadBuffer.enqueue(v(e)))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){let e=this.preloadBuffer.dequeue();e&&eM([...e],this)}}prepareInternalServices(){this.pluginsManager=new no(t5,this.errorHandler,this.logger),this.storeManager=new nO(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new nU(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new n5(this.pluginsManager,this.storeManager,this.httpClient,this.errorHandler,this.logger),this.eventRepository=new n7(this.pluginsManager,this.storeManager,this.httpClient,this.errorHandler,this.logger),this.eventManager=new n4(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){tM.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(tM.lifecycle.writeKey.value),this.configManager?.init()}onPluginsReady(){this.storeManager?.init(),this.userSessionManager?.init(),tM.consents.enabled.value&&!tM.consents.initialized.value&&(this.pluginsManager?.invokeSingle("consentManager.init",tM,this.logger),!1===tM.consents.preConsent.value.enabled&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",tM,this.storeManager,this.logger)),this.eventManager?.init(),tM.lifecycle.status.value="initialized"}onConfigured(){this.pluginsManager?.init()}onInitialized(){this.processDataInPreloadBuffer(),eL(()=>{tM.lifecycle.loaded.value=!0,tM.lifecycle.status.value="loaded"}),this.initialized=!0,n9(tM.loadOptions.value.onLoaded,[globalThis.rudderanalytics],"LoadAPI",this.logger),se("RSA_Initialised")}onReady(){tM.lifecycle.status.value="readyExecuted",tM.eventBuffer.readyCallbacksArray.value.forEach(e=>{n9(e,[],ee,this.logger)}),se("RSA_Ready")}processBufferedEvents(){let e=tM.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){let t=e.shift();if(tM.eventBuffer.toBeProcessedArray.value=e,t){let e=t[0];k(this[e])&&this[e](...t.slice(1),!0)}e=tM.eventBuffer.toBeProcessedArray.value}}loadDestinations(){if("destinationsLoading"===tM.lifecycle.status.value||"destinationsReady"===tM.lifecycle.status.value)return;this.pluginsManager?.invokeSingle("nativeDestinations.setActiveDestinations",tM,this.pluginsManager,this.errorHandler,this.logger);let e=tM.nativeDestinations.activeDestinations.value.length;if(0===e){tM.lifecycle.status.value="destinationsReady";return}tM.lifecycle.status.value="destinationsLoading",this.pluginsManager?.invokeSingle("nativeDestinations.load",tM,this.externalSrcLoader,this.errorHandler,this.logger),e2(()=>{(0===e||tM.nativeDestinations.initializedDestinations.value.length+tM.nativeDestinations.failedDestinations.value.length===e)&&eL(()=>{tM.lifecycle.status.value="destinationsReady",tM.nativeDestinations.clientDestinationsReady.value=!0})})}onDestinationsReady(){"ready"!==tM.lifecycle.status.value&&(tM.lifecycle.status.value="ready")}ready(e,t=!1){let i="ready";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}if(this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),!k(e))return void this.logger.error(tn(ee));"readyExecuted"===tM.lifecycle.status.value?n9(e,[],ee,this.logger):tM.eventBuffer.readyCallbacksArray.value=[...tM.eventBuffer.readyCallbacksArray.value,e]}page(e,t=!1){let i="page";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} event`),tM.metrics.triggered.value+=1,this.eventManager?.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),!0===tM.capabilities.isAdBlocked.value&&e.category!==eA&&this.page(H(eA,"ad-block page request",{path:"/ad-blocked"},tM.loadOptions.value.sendAdblockPageOptions))}track(e,t=!1){let i="track";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} event - ${e.name}`),tM.metrics.triggered.value+=1,this.eventManager?.addEvent({type:i,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})}identify(e,t=!1){let i="identify";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} event`),tM.metrics.triggered.value+=1,e.userId&&tM.session.userId.value&&e.userId!==tM.session.userId.value&&this.reset(),null!==e.userId&&this.userSessionManager?.setUserId(e.userId),this.userSessionManager?.setUserTraits(e.traits),this.eventManager?.addEvent({type:i,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e,t=!1){let i="alias";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} event`),tM.metrics.triggered.value+=1;let r=e.from??(this.getUserId()||this.userSessionManager?.getAnonymousId());this.eventManager?.addEvent({type:i,to:e.to,from:r,options:e.options,callback:e.callback})}group(e,t=!1){let i="group";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} event`),tM.metrics.triggered.value+=1,null!==e.groupId&&this.userSessionManager?.setGroupId(e.groupId),this.userSessionManager?.setGroupTraits(e.traits),this.eventManager?.addEvent({type:i,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})}reset(e,t=!1){let i="reset";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),this.userSessionManager?.reset(e)}getAnonymousId(e){return this.userSessionManager?.getAnonymousId(e)}setAnonymousId(e,t,i=!1){let r="setAnonymousId";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[r,e,t]];return}this.errorHandler.leaveBreadcrumb(`New ${r} invocation`),this.userSessionManager?.setAnonymousId(e,t)}getUserId(){return tM.session.userId.value}getUserTraits(){return tM.session.userTraits.value}getGroupId(){return tM.session.groupId.value}getGroupTraits(){return tM.session.groupTraits.value}startSession(e,t=!1){let i="startSession";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[i,e]];return}this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),this.userSessionManager?.start(e)}endSession(e=!1){let t="endSession";if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[t]];return}this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),this.userSessionManager?.end()}getSessionId(){return this.userSessionManager?.getSessionId()??null}consent(e,t=!1){if(!tM.lifecycle.loaded.value){tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,["consent",e]];return}this.errorHandler.leaveBreadcrumb("New consent invocation"),eL(()=>{tM.consents.preConsent.value={...tM.consents.preConsent.value,enabled:!1},tM.consents.postConsent.value=(e=>{let t={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(D(e)){let i=v(e);t.storage=i.storage,R(i.integrations)&&(t.integrations=i.integrations),t.discardPreConsentEvents=!0===i.discardPreConsentEvents,t.sendPageEvent=!0===i.sendPageEvent,t.trackConsent=!0===i.trackConsent,R(i.consentManagement)&&(t.consentManagement=O(i.consentManagement,{enabled:tM.consents.enabled.value}))}return t})(e);let{initialized:t,consentsData:i}=nL(tM.consents.postConsent.value.consentManagement,this.logger);tM.consents.initialized.value=t,tM.consents.data.value=i}),tM.consents.enabled.value&&!tM.consents.initialized.value&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",tM,this.storeManager,this.logger),this.storeManager?.initializeStorageState(),this.userSessionManager?.syncStorageDataToState(),this.eventManager?.resume(),this.loadDestinations(),this.sendTrackingEvents(t)}sendTrackingEvents(e){if(tM.consents.postConsent.value.trackConsent){let t=F("Consent Management Interaction");e?tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(tM.consents.postConsent.value.sendPageEvent){let t=H();e?tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){this.userSessionManager?.setAuthToken(e)}addCustomIntegration(e,t,i=!1){let r="addCustomIntegration";if(i)this.errorHandler.leaveBreadcrumb(`New ${r} invocation`),this.pluginsManager?.invokeSingle("nativeDestinations.addCustomIntegration",e,t,tM,this.logger);else{if(tM.lifecycle.loaded.value)return void this.logger.error(`${et}:: Cannot add custom integration for destination ID "${e}" after the SDK is loaded.`);tM.eventBuffer.toBeProcessedArray.value=[...tM.eventBuffer.toBeProcessedArray.value,[r,e,t]]}}}class si{static globalSingleton=null;analyticsInstances={};defaultAnalyticsKey="";logger=e8;constructor(){try{if(si.globalSingleton)return si.globalSingleton;si.initializeGlobalResources(),this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),this.addCustomIntegration=this.addCustomIntegration.bind(this),this.createSafeAnalyticsInstance(),si.globalSingleton=this,tM.autoTrack.pageLifecycle.pageViewId.value=el(),tM.autoTrack.pageLifecycle.pageLoadedTimestamp.value=Date.now(),this.triggerBufferedLoadEvent(),globalThis.rudderanalytics=this}catch(e){eI(e)}}createSafeAnalyticsInstance(){tM.lifecycle.safeAnalyticsInstance.value={page:this.page.bind(this),track:this.track.bind(this),identify:this.identify.bind(this),alias:this.alias.bind(this),group:this.group.bind(this),getAnonymousId:this.getAnonymousId.bind(this),getUserId:this.getUserId.bind(this),getUserTraits:this.getUserTraits.bind(this),getGroupId:this.getGroupId.bind(this),getGroupTraits:this.getGroupTraits.bind(this),getSessionId:this.getSessionId.bind(this)}}static initializeGlobalResources(){t2.init(),nC.configure(),nS.configure(),nT.configure(),np.configure()}setDefaultInstanceKey(e){S(e)&&e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){try{let t=e;return S(t)&&t||(t=this.defaultAnalyticsKey),this.analyticsInstances[t]||(this.analyticsInstances[t]=new st),this.analyticsInstances[t]}catch(e){eI(e);return}}load(e,t,i){try{if(this.analyticsInstances[e])return;this.setDefaultInstanceKey(e),this.trackPageLifecycleEvents(i);let r=ex(eT),n="consent",s=r.filter(e=>e[0]===n),a=r.filter(e=>e[0]!==n);r.splice(0,r.length,...s,...a),eR(eT,v(r)),this.getAnalyticsInstance(e)?.load(e,t,ey(i))}catch(e){eI(e)}}trackPageLifecycleEvents(e){let{autoTrack:t,useBeacon:i}=e??{},{enabled:r=!1,options:n={},pageLifecycle:s}=t??{},{events:a=[K.UNLOADED],enabled:o=r,options:l=n}=s??{};tM.autoTrack.pageLifecycle.enabled.value=o,tM.autoTrack.enabled.value=r||o,o&&this.setupPageUnloadTracking(a,i,l)}setupPageUnloadTracking(e,t,i){(0===e.length||e.includes(K.UNLOADED))&&(!0===t?ec(e=>{if(!1===e&&tM.lifecycle.loaded.value){let e=Date.now(),t=e-tM.autoTrack.pageLifecycle.pageLoadedTimestamp.value;this.track(K.UNLOADED,{timeOnPage:t},{...i,originalTimestamp:ed(new Date(e))})}}):this.logger.warn('RudderStackAnalytics:: Page Unloaded event can only be tracked when the Beacon transport is active. Please enable "useBeacon" load API option.'))}triggerBufferedLoadEvent(){let e=Array.isArray(globalThis.rudderanalytics)?globalThis.rudderanalytics:[],t=(e=>{let t=[],i=0;for(;i<e.length;){if(e[i]&&"load"===e[i][0]){t=v(e[i]),e.splice(i,1);break}i+=1}return t})(e);eR(eT,v([...e])),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){try{this.getAnalyticsInstance()?.ready(ey(e))}catch(e){eI(e)}}page(e,t,i,r,n){try{this.getAnalyticsInstance()?.page(H(ey(e),ey(t),ey(i),ey(r),ey(n)))}catch(e){eI(e)}}track(e,t,i,r){try{this.getAnalyticsInstance()?.track(F(ey(e),ey(t),ey(i),ey(r)))}catch(e){eI(e)}}identify(e,t,i,r){try{this.getAnalyticsInstance()?.identify(z(ey(e),ey(t),ey(i),ey(r)))}catch(e){eI(e)}}alias(e,t,i,r){try{this.getAnalyticsInstance()?.alias(Q(ey(e),ey(t),ey(i),ey(r)))}catch(e){eI(e)}}group(e,t,i,r){try{this.getAnalyticsInstance()?.group(G(ey(e),ey(t),ey(i),ey(r)))}catch(e){eI(e)}}reset(e){try{this.getAnalyticsInstance()?.reset(ey(e))}catch(e){eI(e)}}getAnonymousId(e){try{return this.getAnalyticsInstance()?.getAnonymousId(ey(e))}catch(e){eI(e);return}}setAnonymousId(e,t){try{this.getAnalyticsInstance()?.setAnonymousId(ey(e),ey(t))}catch(e){eI(e)}}getUserId(){try{return this.getAnalyticsInstance()?.getUserId()}catch(e){eI(e);return}}getUserTraits(){try{return this.getAnalyticsInstance()?.getUserTraits()}catch(e){eI(e);return}}getGroupId(){try{return this.getAnalyticsInstance()?.getGroupId()}catch(e){eI(e);return}}getGroupTraits(){try{return this.getAnalyticsInstance()?.getGroupTraits()}catch(e){eI(e);return}}startSession(e){try{this.getAnalyticsInstance()?.startSession(ey(e))}catch(e){eI(e)}}endSession(){try{this.getAnalyticsInstance()?.endSession()}catch(e){eI(e)}}getSessionId(){try{return this.getAnalyticsInstance()?.getSessionId()}catch(e){eI(e);return}}setAuthToken(e){try{this.getAnalyticsInstance()?.setAuthToken(ey(e))}catch(e){eI(e)}}consent(e){try{this.getAnalyticsInstance()?.consent(ey(e))}catch(e){eI(e)}}addCustomIntegration(e,t){try{this.getAnalyticsInstance()?.addCustomIntegration(ey(e),ey(t))}catch(e){eI(e)}}}}}]);